<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>üå∏ Ê°úIndex - ÂÖ¨Âºè„Çµ„Ç§„Éà</title>
<style>
:root{--bg:#0b1420;--panel:#0f1b28;--panel2:#0c1926;--border:#1c2a3a;
--text:#d4e9f7;--sub:#9fb6c7;--muted:#7890a0;--brand:#93c5fd;
--up:#34d399;--down:#fb7185;--chip:#0b2233;}
body{margin:0;background:var(--bg);color:var(--text);
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue","Hiragino Sans","Noto Sans JP","Yu Gothic UI","Yu Gothic","Meiryo",sans-serif;}
.wrap{max-width:1160px;margin:32px auto;padding:0 16px}
header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
.title{display:flex;align-items:center;gap:12px}
.title h1{margin:0;font-size:24px;font-weight:700}
.meta{color:var(--muted);font-size:12px;margin-top:4px}
.btns{display:flex;gap:10px}
.btn{background:var(--panel2);border:1px solid var(--border);color:var(--text);
padding:10px 14px;border-radius:10px;font-size:14px;text-decoration:none}
.grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:18px}
@media(max-width:900px){.grid{grid-template-columns:1fr}}
.card{background:linear-gradient(180deg,var(--panel),var(--panel2));
border:1px solid var(--border);border-radius:14px;padding:14px;position:relative}
.card.pos{box-shadow:0 0 0 2px #34d39933 inset}
.card.neg{box-shadow:0 0 0 2px #fb718533 inset}
.head{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.flag{font-size:18px}.name{font-size:18px;font-weight:700}
.badge{font-size:11px;color:var(--sub);background:var(--chip);border:1px solid var(--border);
padding:4px 8px;border-radius:999px}
.desc{color:var(--sub);font-size:12px;margin:0 0 8px 28px}
.pct{position:absolute;top:10px;right:12px;font-weight:800;font-size:16px}
.pct.up{color:var(--up)}.pct.down{color:var(--down)}.pct.na{color:var(--muted)}
.chart{width:100%;height:260px;border-radius:10px;border:1px solid var(--border);
background:#091421;display:flex;align-items:center;justify-content:center;overflow:hidden}
.chart img{width:100%;height:100%;object-fit:contain}
</style>
</head>
<body>
<div class="wrap">
<header>
<div>
<div class="title"><div style="font-size:22px">üå∏</div><h1>Ê°úIndex - ÂÖ¨Âºè„Çµ„Ç§„Éà</h1></div>
<div class="meta" id="syncMeta">ÂêåÊúüÂÆå‰∫ÜÔºö-- Ôºè „Éá„Éº„Çø: charts/*</div>
</div>
<div class="btns">
<a class="btn" href="https://x.com">ÂÖ¨ÂºèXÔºàTwitterÔºâ</a>
<a class="btn" href="https://note.com">ÂÖ¨Âºènote</a>
</div>
</header>
<section class="grid" id="cards"></section>
</div>

<script>
const SITE='https://raw.githubusercontent.com/SakuraIndex/Sakura-Index-Site/main/docs/charts';
const ORIG={
 'ASTRA4':'https://raw.githubusercontent.com/SakuraIndex/3_Sakura_Space/main/docs/outputs',
 'R-BANK9':'https://raw.githubusercontent.com/SakuraIndex/R-BANK9/main/docs/outputs',
 'AIN-10':'https://raw.githubusercontent.com/SakuraIndex/AIN-10/main/docs/outputs',
 'S-COIN+':'https://raw.githubusercontent.com/SakuraIndex/S-COIN-/main/docs/outputs',
};
const FOLDER={'ASTRA4':'ASTRA4','R-BANK9':'R_BANK9','AIN-10':'AIN10','S-COIN+':'S-COIN+'};
const SLUG={'ASTRA4':'astra4','R-BANK9':'rbank9','AIN-10':'ain10','S-COIN+':'scoin_plus'};
const IDX=[
 {key:'ASTRA4',flag:'üáØüáµ',badge:'ÂÆáÂÆô„Éô„É≥„ÉÅ„É£„Éº',desc:'ÂÆáÂÆôÈñ¢ÈÄ£4ÈäòÊüÑ„ÅÆÁ≠â„Ç¶„Çß„Ç§„ÉàÊåáÊï∞„ÄÇ'},
 {key:'R-BANK9',flag:'üáØüáµ',badge:'Âú∞ÊñπÈäÄË°å',desc:'Âú∞ÊñπÈäÄË°å9ÈäòÊüÑ„ÅÆÁ≠â„Ç¶„Çß„Ç§„ÉàÊåáÊï∞„ÄÇ'},
 {key:'AIN-10',flag:'üá∫üá∏',badge:'AIÈñ¢ÈÄ£10',desc:'Á±≥AIÈñ¢ÈÄ£10ÈäòÊüÑ„ÅÆÁ≠â„Ç¶„Çß„Ç§„ÉàÊåáÊï∞„ÄÇ'},
 {key:'S-COIN+',flag:'ü™ô',badge:'‰ªÆÊÉ≥Ë≥áÁî£Èñ¢ÈÄ£',desc:'ÊöóÂè∑Ë≥áÁî£Èñ¢ÈÄ£„ÅÆÁ≠â„Ç¶„Çß„Ç§„ÉàÊåáÊï∞ÔºàÊó•Êú¨Ê†™Ôºâ„ÄÇ'}
];
const $=(s,el=document)=>el.querySelector(s);
const nowJP=()=>new Date().toLocaleString('ja-JP',{hour12:false});
async function ftxt(u){try{const r=await fetch(u,{cache:'no-store'});return r.ok?await r.text():null}catch{return null}}
async function fjson(u){try{const r=await fetch(u,{cache:'no-store'});return r.ok?await r.json():null}catch{return null}}
function pJP(s){const m=s?.match(/(\d{4})[\/-](\d{2})[\/-](\d{2})[ T](\d{2}):(\d{2})/);return m?new Date(m[1],m[2]-1,m[3],m[4],m[5]):null}
function sameDay(a,b){if(!a||!b)return false;return Math.abs(a-b)<1000*60*60*6*4;} // ¬±6hË®±ÂÆπ
function clamp(x,a,b){return Math.max(a,Math.min(b,x))}
function fmt(v){return{t:(v>=0?'+':'')+v.toFixed(2)+'%',c:v>0?'up':v<0?'down':'na'}}

async function pickPct(key){
 const fold=FOLDER[key],base=ORIG[key],slug=SLUG[key],today=new Date();
 const cand=[];
 if(fold){const t=await ftxt(`${SITE}/${fold}/post_intraday.txt`);
   if(t){const ts=pJP(t.match(/\((\d{4}\/\d{2}\/\d{2}\s\d{2}:\d{2})\)/)?.[1]||'');
   const n=parseFloat((t.match(/[+\-]?\d+(?:\.\d+)?/)||[])[0]);if(!isNaN(n))cand.push({v:n,ts});}}
 if(base&&slug){const t=await ftxt(`${base}/${slug}_post_intraday.txt`);
   if(t){const ts=pJP(t.match(/\((\d{4}\/\d{2}\/\d{2}\s\d{2}:\d{2})\)/)?.[1]||'');
   const n=parseFloat((t.match(/[+\-]?\d+(?:\.\d+)?/)||[])[0]);if(!isNaN(n))cand.push({v:n,ts});}}
 const valid=cand.filter(x=>x.ts&&sameDay(x.ts,today));
 if(valid.length){valid.sort((a,b)=>b.ts-a.ts);let v=valid[0].v;if(Math.abs(v)<2)v*=100;return clamp(v,-30,30);}
 if(base&&slug){const j=await fjson(`${base}/${slug}_stats.json`);
   if(j){const fields=['pct_intraday','rtn_intraday','pct','change_pct','change_percent'];
   for(const f of fields){if(j[f]!=null){let v=j[f];if(Math.abs(v)<2)v*=100;return clamp(v,-30,30);}}}}
 return null;
}

async function testImg(u){return new Promise(res=>{const i=new Image();i.onload=()=>res(true);i.onerror=()=>res(false);i.src=u+'?t='+Date.now();});}
async function pickImg(key){
 const fold=FOLDER[key],base=ORIG[key],slug=SLUG[key];
 if(key==='S-COIN+'&&base&&slug){const u=`${base}/${slug}_intraday.png`;if(await testImg(u))return u;}
 if(fold){const t=await ftxt(`${SITE}/${fold}/intraday.txt`);
   const nod=/no\s*data/i.test(t||'');const ts=pJP((t||'').match(/\((\d{4}\/\d{2}\/\d{2}\s\d{2}:\d{2})\)/)?.[1]||'');
   if(!nod&&sameDay(ts,new Date())){const u=`${SITE}/${fold}/intraday.png`;if(await testImg(u))return u;}}
 if(base&&slug){const u=`${base}/${slug}_intraday.png`;if(await testImg(u))return u;}
 return null;
}

async function render(m){
 const v=await pickPct(m.key);
 const pf=v==null?{t:'N/A',c:'na'}:fmt(v);
 const img=await pickImg(m.key);
 const card=document.createElement('div');
 card.className='card '+(pf.c==='up'?'pos':pf.c==='down'?'neg':'');
 card.innerHTML=`<div class="head"><div class="flag">${m.flag}</div><div class="name">${m.key}</div>
 <div class="badge">${m.badge}</div><div class="pct ${pf.c}">${pf.t}</div></div>
 <div class="desc">${m.desc}</div><div class="chart">${img?`<img src="${img}">`:`<div style="color:#7890a0">No data</div>`}</div>`;
 return card;
}
(async()=>{
 $('#syncMeta').textContent=`ÂêåÊúüÂÆå‰∫ÜÔºö${nowJP()} Ôºè „Éá„Éº„Çø: charts/*`;
 const grid=$('#cards');
 for(const m of IDX)grid.appendChild(await render(m));
})();
</script>
</body>
</html>
