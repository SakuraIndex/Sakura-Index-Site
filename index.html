<!--
  title: æ¡œIndex - å…¬å¼ã‚µã‚¤ãƒˆ
  description: docs/charts/* ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ç”¨ã„ãŸç°¡æ˜“ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
  layout: null
-->

<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸŒ¸ æ¡œIndex - å…¬å¼ã‚µã‚¤ãƒˆ</title>
  <style>
    :root{
      --bg:#0f172a;--panel:#0b1220;--panel2:#0e1a2b;--text:#e2e8f0;--muted:#94a3b8;
      --accent:#38bdf8;--chip:#1f2937;--chip-border:#334155;--ok:#22c55e;--bad:#ef4444;
    }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";}

    .container{max-width:1200px;margin:0 auto;padding:28px 16px;}
    .header{display:flex;align-items:center;gap:12px;flex-wrap:wrap;justify-content:space-between}
    .header h1{margin:0;font-size:20px;line-height:1.2}
    .header .meta{font-size:12px;color:var(--muted)}
    .btns{display:flex;gap:8px}
    .btn{
      padding:8px 12px;border-radius:999px;background:#111827;border:1px solid #1f2937;
      color:#cbd5e1;text-decoration:none;font-size:12px
    }
    .grid{display:grid;grid-template-columns:1fr;gap:16px;margin-top:16px}
    @media(min-width:960px){.grid{grid-template-columns:1fr 1fr}}
    .foot{margin:28px 0 16px;color:var(--muted);font-size:12px;text-align:center}

    /* fallback ç”»åƒã®ã‚»ãƒ³ã‚¿ãƒªãƒ³ã‚°ç”¨ï¼ˆinclude å†…ã® PNG æ ãŒç©ºã®ã¨ãï¼‰ */
    .image-fallback{display:flex;align-items:center;justify-content:center;height:260px;color:var(--muted);font-size:13px}

    /* æ—¢å­˜ include ãŒ .index-card, [id=delta-XXX] ã‚’æç”»ã—ã¦ã„ã‚‹æƒ³å®šã§å‹•ãã‚ˆã†ã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯å¤šç³»çµ±ã«å¯¾å¿œ */
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1>ğŸŒ¸ æ¡œIndex - å…¬å¼ã‚µã‚¤ãƒˆ</h1>
        <div class="meta">
          åŒæœŸå®Œäº†ï¼š{{ site.time | date: "%Y/%m/%d %H:%M:%S" }} ï¼ ãƒ‡ãƒ¼ã‚¿: docs/charts/*
        </div>
      </div>
      <div class="btns">
        <a class="btn" href="https://x.com" target="_blank" rel="noopener">å…¬å¼Xï¼ˆTwitterï¼‰</a>
        <a class="btn" href="https://note.com" target="_blank" rel="noopener">å…¬å¼note</a>
      </div>
    </div>

    {%- comment -%}
      è¡¨ç¤ºã™ã‚‹æŒ‡æ•°ã®å®šç¾©
      - id : charts ãƒ•ã‚©ãƒ«ãƒ€å
      - title, badge, desc : è¦‹å‡ºã—
      - json_path : /charts/<id>/stats.json
      - intraday_png : /charts/<id>/intraday.pngï¼ˆå­˜åœ¨ã—ãªã‘ã‚Œã° include å†…ã§è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
      - am_png : å‰å ´ã‚¹ãƒŠãƒƒãƒ—ï¼ˆå­˜åœ¨ã—ãªã„æŒ‡æ•°ã‚‚ã‚ã‚‹ï¼‰
    {%- endcomment -%}
    {%- assign indices =  [
      {"id":"ASTRA4","title":"Astra4","badge":"å®‡å®™ãƒ™ãƒ³ãƒãƒ£ãƒ¼","desc":"å®‡å®™é–¢é€£éŠ˜æŸ„ã®ç­‰ã‚¦ã‚§ã‚¤ãƒˆæŒ‡æ•°ã€‚æ—¥ä¸­ã¯%ã€é•·æœŸã¯ãƒ¬ãƒ™ãƒ«æ¨ç§»ã‚’è¡¨ç¤ºã€‚","json_path":"/charts/ASTRA4/stats.json","intraday_png":"/charts/ASTRA4/intraday.png","am_png":"/charts/ASTRA4/intraday_am.png"},
      {"id":"R-BANK9","title":"R-BANK9","badge":"åœ°æ–¹éŠ€è¡Œ","desc":"åœ°æ–¹éŠ€è¡Œ9éŠ˜æŸ„ã®ç­‰ã‚¦ã‚§ã‚¤ãƒˆæŒ‡æ•°ã€‚æ—¥ä¸­ã¯%ã€é•·æœŸã¯ãƒ¬ãƒ™ãƒ«æ¨ç§»ã‚’è¡¨ç¤ºã€‚","json_path":"/charts/R-BANK9/stats.json","intraday_png":"/charts/R-BANK9/intraday.png","am_png":"/charts/R-BANK9/intraday_am.png"},
      {"id":"AIN-10","title":"AIN-10","badge":"AIé–¢é€£10","desc":"ç±³AIé–¢é€£10éŠ˜æŸ„ã®ç­‰ã‚¦ã‚§ã‚¤ãƒˆæŒ‡æ•°ã€‚çŸ­æœŸãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ è¦³æ¸¬ã«ä¾¿åˆ©ã€‚","json_path":"/charts/AIN-10/stats.json","intraday_png":"/charts/AIN-10/intraday.png","am_png":"/charts/AIN-10/intraday_am.png"},
      {"id":"S-COIN+","title":"S-COIN+","badge":"ä»®æƒ³è³‡ç”£é–¢é€£","desc":"æš—å·è³‡ç”£é–¢é€£ã®ç­‰ã‚¦ã‚§ã‚¤ãƒˆæŒ‡æ•°ã€‚æ—¥ä¸­ã¯é¨°è½ç‡ã€é•·æœŸã¯ãƒ¬ãƒ™ãƒ«æ¨ç§»ã‚’è¡¨ç¤ºã€‚","json_path":"/charts/S-COIN+/stats.json","intraday_png":"/charts/S-COIN+/intraday.png","am_png":"/charts/S-COIN+/intraday_am.png"}
    ] -%}

    <div class="grid">
      {%- for idx in indices -%}
        {%- include components/index-card.html
            id=idx.id
            title=idx.title
            badge=idx.badge
            description=idx.desc
            json_path=idx.json_path
            intraday_png=idx.intraday_png
            am_png=idx.am_png
        -%}
      {%- endfor -%}
    </div>

    <div class="foot">
      ãƒ‡ãƒ¼ã‚¿ï¼šå„æŒ‡æ•°ã¯ç­‰åŠ é‡æŒ‡æ•°ï¼ˆä»•æ§˜ã¯å„ãƒªãƒã‚¸ãƒˆãƒªå‚ç…§ï¼‰ ï¼ ç”»åƒã¯å„æŒ‡æ•°ãƒªãƒã‚¸ãƒˆãƒªã®è‡ªå‹•ç”Ÿæˆã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¨åŒæœŸã—ã¦ã„ã¾ã™ã€‚<br />
      â€»æœ¬ã‚µã‚¤ãƒˆã¯æŠ•è³‡åŠ©è¨€ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æŠ•è³‡åˆ¤æ–­ã¯ã”è‡ªèº«ã®è²¬ä»»ï¼ˆè‡ªå·±è²¬ä»»ï¼‰ã§ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚<br />
      Â© {{ "now" | date: "%Y" }} æ¡œIndex
    </div>
  </div>

  <script>
    /**
     * JSON ã®æ•°å€¤ã‹ã‚‰ã€ãã®ã¾ã¾ã€Œ%ã€ã¨ã—ã¦è§£é‡ˆã—ã¦è‰¯ã„ã‹ã©ã†ã‹ã‚’åˆ¤å®šã€‚
     * - æ˜ç¤ºçš„ã« scale/value_type ãŒ percent ãªã‚‰ true
     * - æŒ‡å®šãŒç„¡ã„å ´åˆã§ã‚‚ã€Œçµ¶å¯¾å€¤ â‰¦ 3.5ã€ç¨‹åº¦ãªã‚‰ % ã¨è¦‹ãªã™ï¼ˆæŒ‡æ•°ã®å½“æ—¥å¤‰å‹•ã¨ã—ã¦ç¾å®Ÿçš„ãªç¯„å›²ï¼‰
     */
    function isPercentLike(stats, value){
      const hinted =
        (typeof stats?.scale === 'string' && stats.scale.toLowerCase() === 'percent') ||
        (typeof stats?.value_type === 'string' && stats.value_type.toLowerCase() === 'percent');
      if (hinted) return true;
      return Math.abs(value) <= 3.5;
    }

    /**
     * é¨°è½ç‡ã®å„ªå…ˆé †ä½ã¨å˜ä½åˆ¤å®š
     *  1) pct_intraday
     *  2) pct_id            â€¦ AIN-10 ãªã©ã§æ¡ç”¨ã•ã‚Œã‚‹ã“ã¨ãŒå¤šã„
     *  3) delta_level(%)    â€¦ scale/value_type ãŒ percent ã®ã¨ãã®ã¿ % ã¨ã¿ãªã™
     * å˜ä½åˆ¤å®š:
     *  - percent ãƒ’ãƒ³ãƒˆãŒã‚ã‚‹ or æ•°å€¤ãŒå°ã•ã„(â‰¦3.5) â†’ ãã®ã¾ã¾ %
     *  - ãã‚Œä»¥å¤– â†’ ratio ã¨ã¿ãªã—ã¦ Ã—100
     */
    function pickDeltaPct(stats){
      const num = (x)=> typeof x === 'number' && Number.isFinite(x);
      let v = null;

      if (num(stats?.pct_intraday)) {
        v = stats.pct_intraday;
      } else if (num(stats?.pct_id)) {
        v = stats.pct_id;
      } else if (num(stats?.delta_level)) {
        // delta_level ã¯ % ã§ä¾›çµ¦ã•ã‚Œã‚‹ã“ã¨ãŒå¤šã„ï¼ˆscale/value_type ã« percent æŒ‡å®šãŒç„¡ã„å ´åˆã¯å°ã•ã•ã§åˆ¤å®šï¼‰
        v = stats.delta_level;
      }

      if (!num(v)) return null;

      if (isPercentLike(stats, v)) {
        return v;           // ã™ã§ã« %
      }
      return v * 100;       // ratio â†’ %
    }

    function fmtPct(x){
      // å¤§ãã•ã«å¿œã˜ã¦å°æ•°ç‚¹ã‚’èª¿æ•´ï¼ˆè¦‹ã‚„ã™ã•é‡è¦–ï¼‰
      const abs = Math.abs(x);
      const dp = abs >= 10 ? 2 : abs >= 1 ? 2 : 2; // çµ±ä¸€ 2æ¡
      return (x>=0?'+':'') + x.toFixed(dp) + '%';
    }

    // æ—¢çŸ¥ã® ID/ãƒ‘ã‚¹ï¼ˆinclude å¼•æ•°ã¨åŒä¸€ï¼‰
    const INDICES = [
      { id: 'ASTRA4', json: '/charts/ASTRA4/stats.json' },
      { id: 'R-BANK9', json: '/charts/R-BANK9/stats.json' },
      { id: 'AIN-10',  json: '/charts/AIN-10/stats.json'  },
      { id: 'S-COIN+', json: '/charts/S-COIN+/stats.json'}
    ];

    async function updateOne({id, json}){
      try{
        const res = await fetch(json, {cache:'no-store'});
        if(!res.ok) throw new Error('HTTP '+res.status);
        const stats = await res.json();

        const pct = pickDeltaPct(stats);
        const text = (pct==null)? 'N/A' : fmtPct(pct);

        // 1) id ãŒ #delta-<ID> ã®è¦ç´ ï¼ˆå‰å›ã® include ãŒå‡ºåŠ›ã—ã¦ã„ã‚‹æƒ³å®šï¼‰
        const el1 = document.getElementById(`delta-${id}`);
        if (el1) el1.textContent = text;

        // 2) data-delta-for="<ID>" ã§ã‚‚æ‹¾ã†ï¼ˆå°†æ¥äº’æ›ï¼‰
        document.querySelectorAll(`[data-delta-for="${CSS.escape(id)}"]`).forEach(e=>e.textContent=text);

        // 3) .index-card[data-id="<ID>"] å†…ã® .delta ã§ã‚‚æ‹¾ã†ï¼ˆä¿é™ºï¼‰
        document.querySelectorAll(`.index-card[data-id="${CSS.escape(id)}"] .delta`).forEach(e=>e.textContent=text);
      }catch(e){
        console.warn('delta update failed for', id, e);
      }
    }

    (async ()=>{
      await Promise.all(INDICES.map(updateOne));
    })();
  </script>
</body>
</html>
