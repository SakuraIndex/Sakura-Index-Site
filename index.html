<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>🌸桜Index - 公式サイト</title>
<style>
  :root{
    --bg:#0d1016;--panel:#141924;--text:#e8eef9;--muted:#8ea0bf;
    --ring:#1e2a3d;--chip:#1b2333;--accent:#6ad3ff;--up:#54f7a3;--down:#ff6f6f;
  }
  body{margin:0;background:var(--bg);color:var(--text);font:14px/1.6 system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  a{text-decoration:none;color:inherit}
  header{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:10px;margin-bottom:24px}
  .wrap{max-width:1200px;margin:auto;padding:24px}
  .title{font-size:26px;font-weight:700;display:flex;align-items:center;gap:8px}
  .meta{font-size:12px;color:var(--muted)}
  .btns{display:flex;gap:8px}
  .btn{background:var(--chip);border:1px solid var(--ring);border-radius:10px;padding:6px 12px;font-size:13px}
  .grid{display:grid;gap:18px}
  @media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}
  .card{background:var(--panel);border:1px solid var(--ring);border-radius:14px;overflow:hidden}
  .card-hd{display:flex;align-items:center;justify-content:space-between;padding:12px 16px}
  .id-left{display:flex;align-items:center;gap:10px}
  .flag{font-size:16px}
  .badge{font-size:12px;background:var(--chip);padding:3px 8px;border-radius:999px;border:1px solid var(--ring);color:var(--muted)}
  .pct{font-weight:700}
  .pct.up{color:var(--up)}.pct.down{color:var(--down)}.pct.na{color:var(--muted)}
  .desc{color:var(--muted);padding:0 16px 8px;font-size:13px}
  .chart{background:#0e131b;border-radius:12px;border:1px solid var(--ring);margin:0 12px 8px;padding:10px;display:flex;align-items:center;justify-content:center;min-height:240px}
  .chart img{max-width:100%;max-height:100%;object-fit:contain;display:block}
  .tabs{display:flex;flex-wrap:wrap;gap:8px;padding:8px 12px 16px}
  .tabs button{background:var(--chip);border:1px solid var(--ring);padding:6px 12px;border-radius:999px;color:var(--muted);cursor:pointer}
  .tabs button.active{color:var(--text);box-shadow:0 0 0 2px var(--accent) inset}
  footer{margin-top:40px;text-align:center;font-size:12px;color:var(--muted);line-height:1.8}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <div class="title">🌸 桜Index - 公式サイト</div>
      <div class="meta">同期完了: <span id="syncAt">--</span> / データ: docs/charts/*</div>
    </div>
    <div class="btns">
      <a href="https://x.com" target="_blank" class="btn">公式X（Twitter）</a>
      <a href="https://note.com" target="_blank" class="btn">公式note</a>
    </div>
  </header>

  <section id="grid" class="grid"></section>

  <footer>
    データ: 各指数は等加重指数（仕様は各リポジトリ参照）<br>
    画像は各指数リポ生成スナップショットを同期しています。<br>
    ※本サイトは投資助言ではありません。投資判断はご自身の責任（自己責任）でお願いします。<br>
    © 2025 桜Index
  </footer>
</div>

<script>
/* === index構成 === */
const INDEXES = [
  { key:"astra4",  flag:"🇯🇵", name:"Astra4",  tag:"宇宙ベンチャー", desc:"宇宙関連銘柄の等ウェイト指数。可視化はボラティリティに配慮。"},
  { key:"rbank9",  flag:"🇯🇵", name:"R-BANK9", tag:"地方銀行", desc:"地方銀行9銘柄の等ウェイト指数。日中は%、長期はレベル推移を表示。"},
  { key:"ain10",   flag:"🇺🇸", name:"AIN-10",  tag:"AI関連10", desc:"米AI関連10銘柄の等ウェイト指数。短期モメンタム観測に便利。"},
  { key:"scoin_plus", flag:"🇯🇵", name:"S-COIN+", tag:"仮想資産関連", desc:"暗号資産関連の等ウェイト指数。日中は騰落率、長期はレベル推移を表示。"}
];

const VARS = ["intraday","am","7d","1m","1y"];
document.getElementById("syncAt").textContent =
  new Date().toLocaleString("ja-JP",{hour12:false});

/* === DOM生成 === */
const grid=document.getElementById("grid");
for(const idx of INDEXES){
  const el=document.createElement("article");
  el.className="card";
  el.innerHTML=`
    <div class="card-hd">
      <div class="id-left"><span class="flag">${idx.flag}</span>
      <b>${idx.name}</b><span class="badge">${idx.tag}</span></div>
      <div class="pct na" id="${idx.key}-pct">N/A</div>
    </div>
    <p class="desc">${idx.desc}</p>
    <div class="chart"><img id="${idx.key}-img" alt="${idx.name} chart"></div>
    <div class="tabs">
      ${VARS.map(v=>`<button data-v="${v}" class="${v==="intraday"?"active":""}">${tabName(v)}</button>`).join("")}
    </div>`;
  grid.appendChild(el);
}

/* === メタJSON読込・画像更新 === */
const BASE="docs/charts";
const META_DIR=`${BASE}/meta`;

(async()=>{
  for(const idx of INDEXES){
    const meta=await fetchJSON(`${META_DIR}/${idx.key}.json`);
    updateCard(idx,meta);
  }
})();

/* === 関数 === */
function tabName(v){
  return v==="intraday"?"Intraday":v==="am"?"前場(AM)":v==="7d"?"7日":v==="1m"?"1ヶ月":"1年";
}
async function fetchJSON(url){
  try{const r=await fetch(url,{cache:"no-store"});if(!r.ok)throw 0;return await r.json();}
  catch{return null;}
}

function updateCard(idx,meta){
  const pct=document.getElementById(`${idx.key}-pct`);
  const img=document.getElementById(`${idx.key}-img`);
  const tabs=document.querySelectorAll(`[data-v][class*="active"]`);
  const p = getHeadline(meta);
  if(p==null){pct.textContent="N/A";pct.className="pct na";}
  else if(p>0){pct.textContent=`+${p.toFixed(2)}%`;pct.className="pct up";}
  else if(p<0){pct.textContent=`${p.toFixed(2)}%`;pct.className="pct down";}
  else {pct.textContent="0.00%";pct.className="pct";}
  const snap=meta?.snapshots?.intraday||meta?.snapshots?.["1d"]||meta?.snapshots?.["7d"];
  img.src=snap?`${BASE}/${snap}?v=${Date.now()}`:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";

  // tabクリックイベント
  const card=img.closest(".card");
  card.querySelectorAll(".tabs button").forEach(b=>{
    b.onclick=()=>{
      card.querySelectorAll(".tabs button").forEach(x=>x.classList.remove("active"));
      b.classList.add("active");
      const v=b.dataset.v;
      const target=meta?.snapshots?.[v]||snap;
      img.src=target?`${BASE}/${target}?v=${Date.now()}`:img.src;
    };
  });
}

function getHeadline(meta){
  if(!meta)return null;
  if(meta.percent?.intraday!=null)return meta.percent.intraday;
  if(meta.level?.["1d"]!=null)return meta.level["1d"];
  return null;
}
</script>
</body>
</html>
