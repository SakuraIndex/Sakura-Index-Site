<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>🌸 桜Index - 公式サイト</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body class="bg-dark text-light">
  <header>
    <h1>🌸 桜Index - 公式サイト</h1>
    <p id="synctime">同期完了: --</p>
  </header>

  <main id="dashboard" class="grid grid-cols-2 gap-4 p-4">
    <!-- 各指数パネル -->
    <section id="astra4" class="panel">
      <div class="si-header">
        <span class="si-title">🇯🇵 Astra4</span>
        <span class="si-percent">—</span>
      </div>
      <img src="docs/charts/astra4_1d.png" alt="Astra4 chart" />
      <p class="si-updated">—</p>
    </section>

    <section id="scoin_plus" class="panel">
      <div class="si-header">
        <span class="si-title">🇯🇵 S-COIN+</span>
        <span class="si-percent">—</span>
      </div>
      <img src="docs/charts/scoin_plus_1d.png" alt="S-COIN+ chart" />
      <p class="si-updated">—</p>
    </section>

    <section id="rbank9" class="panel">
      <div class="si-header">
        <span class="si-title">🇯🇵 R-BANK9</span>
        <span class="si-percent">—</span>
      </div>
      <img src="docs/charts/rbank9_1d.png" alt="R-BANK9 chart" />
      <p class="si-updated">—</p>
    </section>

    <section id="ain10" class="panel">
      <div class="si-header">
        <span class="si-title">🇺🇸 AIN-10</span>
        <span class="si-percent">—</span>
      </div>
      <img src="docs/charts/ain10_1d.png" alt="AIN-10 chart" />
      <p class="si-updated">—</p>
    </section>
  </main>

  <footer class="text-center text-gray-400 p-2 text-sm">
    データ：等加重指数（仕様は各リポジトリ参照）／画像は各指数リポの自動生成スナップショットを同期しています。<br>
    ※本サイトは投資助言ではありません。投資判断はご自身の責任（自己責任）でお願いします。<br>
    © 2025 桜Index
  </footer>

  <!-- 改良版スクリプト -->
  <script>
    const META = {
      astra4:    { label: 'Astra4',  flag: '🇯🇵' },
      scoin_plus:{ label: 'S-COIN+', flag: '🇯🇵' },
      rbank9:    { label: 'R-BANK9', flag: '🇯🇵' },
      ain10:     { label: 'AIN-10',  flag: '🇺🇸' },
    };

    function fmtJST(iso) {
      try {
        const d = new Date(iso);
        if (Number.isNaN(d.getTime())) return '—';
        return d.toLocaleString('ja-JP', {
          timeZone: 'Asia/Tokyo',
          year: 'numeric', month: '2-digit', day: '2-digit',
          hour: '2-digit', minute: '2-digit', second: '2-digit',
          hour12: false
        });
      } catch {
        return '—';
      }
    }

    async function loadPanel(key) {
      const meta = META[key] || {label:key, flag:''};
      const el = document.getElementById(key);
      if (!el) return;

      let pct = null, updated = '—';
      try {
        const s = await (await fetch(`docs/charts/${key}_stats.json`, {cache:'no-store'})).json();
        if (typeof s?.pct_1d === 'number') pct = s.pct_1d;
        if (typeof s?.updated_at === 'string') updated = fmtJST(s.updated_at);
      } catch {}

      el.querySelector('.si-title').textContent   = `${meta.flag} ${meta.label}`;
      el.querySelector('.si-percent').textContent = (pct === null) ? '—' : `${pct >= 0 ? '+' : ''}${pct.toFixed(2)}%`;
      el.querySelector('.si-updated').textContent = updated || '—';
    }

    async function init() {
      const keys = ['astra4','scoin_plus','rbank9','ain10'];
      for (const k of keys) await loadPanel(k);
      document.getElementById('synctime').textContent = 
        `同期完了: ${fmtJST(new Date().toISOString())} / データ: docs/charts/*`;
    }

    init();
  </script>
</body>
</html>
