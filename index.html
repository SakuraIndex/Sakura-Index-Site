<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸŒ¸ æ¡œIndex - å…¬å¼ã‚µã‚¤ãƒˆ</title>
  <link rel="icon" href="https://emojiapi.dev/api/v1/cherry-blossom.svg" />
  <style>
    :root{
      --bg:#0d0d0f; --card:#1a1a1f; --ink:#ddd; --muted:#aaa;
      --chip:#333; --chip-ink:#ccc;
      --good:#28e07c; --bad:#ff4d4d;
      --plot-bg:#0f0f12;
      --grid-gap:20px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font-family:system-ui,"Inter","Noto Sans JP",sans-serif;
    }
    header{ text-align:center; padding:24px 16px 8px }
    h1{ margin:0 0 6px; font-size:clamp(20px,3vw,28px) }
    .info{ color:var(--muted); font-size:0.9rem; margin-bottom:14px }
    .links{ display:flex; justify-content:center; gap:10px; margin:8px 0 18px }
    .links a{
      background:var(--chip); color:#fff; text-decoration:none;
      padding:8px 14px; border-radius:8px; font-size:0.9rem
    }

    /* 2Ã—2 ã‚°ãƒªãƒƒãƒ‰ï¼ˆæ¨ªå¹…ã«å¿œã˜ã¦ä¸€åˆ—/äºŒåˆ—/ä¸‰åˆ—ã¾ã§è‡ªå‹•ï¼‰ */
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(420px,1fr));
      gap:var(--grid-gap);
      padding:0 24px 36px;
      max-width:1400px; margin:0 auto;
    }

    .card{
      background:var(--card); border-radius:16px; padding:16px;
      box-shadow:0 0 12px rgba(255,255,255,.05);
      display:flex; flex-direction:column; gap:12px;
    }
    .card-header{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
    }
    .title{ display:flex; align-items:center; gap:8px; font-weight:700 }
    .category{ font-size:.8rem; background:var(--chip); color:var(--chip-ink); padding:2px 6px; border-radius:6px }
    .percent{ font-weight:700 }
    .percent.positive{ color:var(--good) }
    .percent.negative{ color:var(--bad) }

    .chart{
      width:100%; background:var(--plot-bg);
      border-radius:12px; overflow:hidden; display:flex; align-items:center; justify-content:center;
    }
    /* ã“ã“ã§å„ãƒãƒ£ãƒ¼ãƒˆç”»åƒã®é«˜ã•ã‚’æƒãˆã‚‹ */
    .chart img{
      width:100%; height:260px; object-fit:contain; display:block;
      background:var(--plot-bg);
    }

    footer{
      text-align:center; font-size:.8rem; color:#888;
      padding:16px 12px 28px;
    }
  </style>
</head>
<body>
<header>
  <h1>ğŸŒ¸ æ¡œIndex - å…¬å¼ã‚µã‚¤ãƒˆ</h1>
  <div class="info" id="sync-info">åŒæœŸå®Œäº†: â€” / ãƒ‡ãƒ¼ã‚¿: docs/charts/*</div>
  <div class="links">
    <a href="https://x.com/SakuraIndex" target="_blank" rel="noopener">å…¬å¼Xï¼ˆTwitterï¼‰</a>
    <a href="https://note.com/sakuraindex" target="_blank" rel="noopener">å…¬å¼note</a>
  </div>
</header>

<main class="grid" id="grid"></main>

<footer>
  ãƒ‡ãƒ¼ã‚¿ï¼šç­‰åŠ é‡æŒ‡æ•°ï¼ˆä»•æ§˜ã¯å„ãƒªãƒã‚¸ãƒˆãƒªå‚ç…§ï¼‰ / ç”»åƒã¯å„æŒ‡æ•°ãƒªãƒã®è‡ªå‹•ç”Ÿæˆã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’åŒæœŸã—ã¦ã„ã¾ã™ã€‚<br />
  â€»æœ¬ã‚µã‚¤ãƒˆã¯æŠ•è³‡åŠ©è¨€ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æŠ•è³‡åˆ¤æ–­ã¯ã”è‡ªèº«ã®è²¬ä»»ï¼ˆè‡ªå·±è²¬ä»»ï¼‰ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚<br />
  Â© 2025 æ¡œIndex
</footer>

<script>
/** è¡¨ç¤ºã™ã‚‹4æŒ‡æ•°ï¼ˆid ã¯ãƒ•ã‚¡ã‚¤ãƒ«æ¥é ­è¾ã¨ä¸€è‡´ã•ã›ã‚‹ï¼‰ */
const INDICES = [
  { id: "astra4",     name: "Astra4",  category: "å®‡å®™ãƒ™ãƒ³ãƒãƒ£ãƒ¼", flag: "ğŸ‡¯ğŸ‡µ" },
  { id: "scoin_plus", name: "S-COIN+", category: "ä»®æƒ³é€šè²¨é–¢é€£",   flag: "ğŸ’±" },
  { id: "rbank9",     name: "R-BANK9", category: "åœ°æ–¹éŠ€è¡Œ",       flag: "ğŸ‡¯ğŸ‡µ" },
  { id: "ain10",      name: "AIN-10",  category: "AIé–¢é€£10",       flag: "ğŸ‡ºğŸ‡¸" },
];

function fmtPct(v){
  if (v === null || Number.isNaN(v)) return "N/A";
  const sign = v >= 0 ? "+" : "";
  return `${sign}${v.toFixed(2)}%`;
}

async function fetchJSON(path){
  const r = await fetch(path, { cache: "no-store" });
  if (!r.ok) throw new Error(`${path} ${r.status}`);
  return r.json();
}

async function render(){
  // ãƒ˜ãƒƒãƒ€ã®ã€ŒåŒæœŸå®Œäº†ã€æ™‚åˆ»ã‚’ JST ã§è¡¨ç¤º
  const jst = new Date().toLocaleString("ja-JP", { timeZone: "Asia/Tokyo" });
  document.getElementById("sync-info").textContent = `åŒæœŸå®Œäº†: ${jst} / ãƒ‡ãƒ¼ã‚¿: docs/charts/*`;

  const grid = document.getElementById("grid");

  for (const x of INDICES){
    const statsPath = `docs/charts/${x.id}_stats.json`;
    const imgPath   = `docs/charts/${x.id}_1d.png`;

    /** æ—¢å®šå€¤ */
    let pct = null;

    try{
      const js = await fetchJSON(statsPath);
      // å„ãƒªãƒã® long_charts.py ã¯ pct_1d ã‚’ %ã‚¹ã‚±ãƒ¼ãƒ«ã§å‡ºåŠ›ã™ã‚‹å‰æ
      pct = (typeof js.pct_1d === "number") ? js.pct_1d : null;
    }catch(e){
      console.warn(`[stats missing] ${x.id}:`, e.message);
    }

    const percentText = fmtPct(pct);
    const colorClass  = (pct === null) ? "" : (pct >= 0 ? "positive" : "negative");

    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <div class="card-header">
        <div class="title">${x.flag} ${x.name} <span class="category">${x.category}</span></div>
        <div class="percent ${colorClass}">${percentText}</div>
      </div>
      <div class="chart"><img src="${imgPath}" alt="${x.name} chart" loading="lazy" /></div>
    `;
    grid.appendChild(card);
  }
}
render();
</script>
</body>
</html>
