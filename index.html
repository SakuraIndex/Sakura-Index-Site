<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸŒ¸ æ¡œIndex - å…¬å¼ã‚µã‚¤ãƒˆ</title>
  <meta name="description" content="Astra4ãƒ»S-COIN+ãƒ»R-BANK9ãƒ»AIN-10 ã®4æŒ‡æ•°ã‚’1ç”»é¢ã§åŒæ™‚è¡¨ç¤ºã€‚æ™‚é–“è»¸ã‚’ä¸€æ‹¬åˆ‡æ›¿ã€‚">
  <style>
    :root{
      --bg:#0e1014; --panel:#171a22; --text:#e9ecf1; --muted:#a7afc0;
      --chip:#232838; --chip-active:#33405c; --ring:#384055; --accent:#79e3d6;
      --pink:#ff86b5;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font:16px/1.6 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue","Noto Sans JP","Yu Gothic","Meiryo",sans-serif;
    }
    header{padding:28px 20px 12px;text-align:center}
    h1{margin:0 0 8px;font-size:28px;font-weight:800;color:var(--pink)}
    .sub{color:var(--muted);font-size:14px}
    .headLinks{display:flex;gap:8px;justify-content:center;margin-top:10px}
    .headLinks a{display:inline-flex;gap:8px;align-items:center;padding:8px 12px;border-radius:10px;background:var(--chip);color:#fff;text-decoration:none;box-shadow:inset 0 0 0 1px var(--ring)}
    .toolbar{margin:18px auto 10px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
    .chip{appearance:none;border:none;cursor:pointer;padding:8px 14px;border-radius:999px;background:var(--chip);color:var(--text);font-weight:600;box-shadow:inset 0 0 0 1px var(--ring);transition:.15s}
    .chip:hover{transform:translateY(-1px)}
    .chip.is-active{background:var(--chip-active);box-shadow:0 0 0 2px var(--accent) inset;color:#fff}
    .grid{width:min(1280px,92vw);margin:0 auto 28px;display:grid;gap:16px;grid-template-columns:1fr}
    @media (min-width:900px){.grid{grid-template-columns:1fr 1fr}}
    .card{background:var(--panel);border-radius:16px;box-shadow:0 0 0 1px var(--ring);overflow:hidden}
    .card__head{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid var(--ring);background:linear-gradient(180deg,rgba(121,227,214,.07),transparent)}
    .title{display:flex;align-items:center;gap:10px;font-weight:800}
    .flag{font-size:18px;line-height:1}
    .badge{font-size:12px;padding:2px 8px;border-radius:999px;background:#2a3044;color:#cdd7ff;box-shadow:inset 0 0 0 1px var(--ring)}
    .pngnote{color:var(--muted);font-size:12px}
    .delta{font-weight:700;margin-left:6px;font-variant-numeric:tabular-nums}
    .delta.up{color:#32e0cf}.delta.down{color:#ff6b6b}.delta.flat{color:#9aa0a6}
    .imgWrap{position:relative;background:#0b0d12}
    .chart{display:block;width:100%;aspect-ratio:16/9;object-fit:contain;background:#0b0d12}
    .nodata{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:#91a0c4;font-weight:700;letter-spacing:.02em;opacity:0;transition:.15s}
    .imgWrap.is-error .nodata{opacity:1}
    .timestamp{text-align:right;font-size:12px;color:var(--muted);padding:6px 10px 10px;border-top:1px solid var(--ring)}
    footer{padding:20px 12px 28px;text-align:center;color:var(--muted);font-size:13px;line-height:1.8}
    .disclaimer{margin-top:10px;font-size:13px;color:#ffb2b2}
    a{color:#a7dfff}
  </style>
</head>
<body>
  <header>
    <h1>ğŸŒ¸ æ¡œIndex - å…¬å¼ã‚µã‚¤ãƒˆ</h1>
    <div class="sub">Astra4ãƒ»S-COIN+ãƒ»R-BANK9ãƒ»AIN-10 ã‚’åŒæ™‚è¡¨ç¤ºã€‚æ™‚é–“è»¸ã‚’ä¸€æ‹¬ã§åˆ‡æ›¿ã§ãã¾ã™ã€‚</div>
    <div class="headLinks">
      <a href="https://twitter.com/SakuraIndex" target="_blank" rel="noreferrer noopener">å…¬å¼Xï¼ˆTwitterï¼‰</a>
      <a href="https://note.com/sakuraindex" target="_blank" rel="noreferrer noopener">å…¬å¼note</a>
    </div>
    <div class="toolbar" id="tfToolbar" role="tablist" aria-label="æ™‚é–“è»¸">
      <button class="chip is-active" data-tf="1d"  aria-selected="true">1æ—¥</button>
      <button class="chip"          data-tf="7d"  aria-selected="false">1é€±é–“</button>
      <button class="chip"          data-tf="1m"  aria-selected="false">1ãƒ¶æœˆ</button>
      <button class="chip"          data-tf="1y"  aria-selected="false">1å¹´</button>
    </div>
  </header>

  <main class="grid" id="grid">
    <!-- Astra4 ğŸ‡¯ğŸ‡µ å®‡å®™ãƒ™ãƒ³ãƒãƒ£ãƒ¼ -->
    <section class="card" data-prefix="astra4">
      <div class="card__head">
        <div class="title"><span class="flag">ğŸ‡¯ğŸ‡µ</span><span>Astra4</span><span class="badge">å®‡å®™ãƒ™ãƒ³ãƒãƒ£ãƒ¼</span><span id="delta-astra4" class="delta flat">â€”</span></div>
        <div class="pngnote">PNGã‚’é™çš„è¡¨ç¤ºï¼ˆè‡ªå‹•æ›´æ–°ï¼‰</div>
      </div>
      <div class="imgWrap"><img class="chart" alt="Astra4 chart" /><div class="nodata">No data</div></div>
      <div class="timestamp">æœ€çµ‚æ›´æ–°ï¼šèª­è¾¼ä¸­...</div>
    </section>

    <!-- S-COIN+ ğŸ‡¯ğŸ‡µ -->
    <section class="card" data-prefix="scoin_plus">
      <div class="card__head">
        <div class="title"><span class="flag">ğŸ‡¯ğŸ‡µ</span><span>S-COIN+</span><span class="badge">ä»®æƒ³é€šè²¨</span><span id="delta-scoin" class="delta flat">â€”</span></div>
        <div class="pngnote">PNGã‚’é™çš„è¡¨ç¤ºï¼ˆè‡ªå‹•æ›´æ–°ï¼‰</div>
      </div>
      <div class="imgWrap"><img class="chart" alt="S-COIN+ chart" /><div class="nodata">No data</div></div>
      <div class="timestamp">æœ€çµ‚æ›´æ–°ï¼šèª­è¾¼ä¸­...</div>
    </section>

    <!-- R-BANK9 ğŸ‡¯ğŸ‡µ -->
    <section class="card" data-prefix="rbank9">
      <div class="card__head">
        <div class="title"><span class="flag">ğŸ‡¯ğŸ‡µ</span><span>R-BANK9</span><span class="badge">åœ°æ–¹éŠ€è¡Œ</span><span id="delta-rbank9" class="delta flat">â€”</span></div>
        <div class="pngnote">PNGã‚’é™çš„è¡¨ç¤ºï¼ˆè‡ªå‹•æ›´æ–°ï¼‰</div>
      </div>
      <div class="imgWrap"><img class="chart" alt="R-BANK9 chart" /><div class="nodata">No data</div></div>
      <div class="timestamp">æœ€çµ‚æ›´æ–°ï¼šèª­è¾¼ä¸­...</div>
    </section>

    <!-- AIN-10 ğŸ‡ºğŸ‡¸ -->
    <section class="card" data-prefix="ain10">
      <div class="card__head">
        <div class="title"><span class="flag">ğŸ‡ºğŸ‡¸</span><span>AIN-10</span><span class="badge">AIé–¢é€£10</span><span id="delta-ain10" class="delta flat">â€”</span></div>
        <div class="pngnote">PNGã‚’é™çš„è¡¨ç¤ºï¼ˆè‡ªå‹•æ›´æ–°ï¼‰</div>
      </div>
      <div class="imgWrap"><img class="chart" alt="AIN-10 chart" /><div class="nodata">No data</div></div>
      <div class="timestamp">æœ€çµ‚æ›´æ–°ï¼šèª­è¾¼ä¸­...</div>
    </section>
  </main>

  <footer>
    ãƒ‡ãƒ¼ã‚¿ï¼šç­‰åŠ é‡æŒ‡æ•°ï¼ˆè©³ç´°ã¯å„ãƒªãƒã‚¸ãƒˆãƒªå‚ç…§ï¼‰ ï¼ ç”»åƒã¯å„æŒ‡æ•°ãƒ¬ãƒã®è‡ªå‹•ç”Ÿæˆã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’åŒæœŸã—ã¦ã„ã¾ã™ã€‚<br>
    Â© 2025 æ¡œIndex<br>
    <div class="disclaimer">â€» æœ¬ã‚µã‚¤ãƒˆã¯æŠ•è³‡åŠ©è¨€ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æŠ•è³‡åˆ¤æ–­ã¯ã”è‡ªèº«ã®è²¬ä»»ï¼ˆè‡ªå·±è²¬ä»»ï¼‰ã§ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚</div>
  </footer>

  <script>
    // === è¡¨ç¤ºè¨­å®š ===
    const ASSET_BASE = "docs/charts";
    const INDEX_PREFIXES = ["astra4","scoin_plus","rbank9","ain10"];
    const DEFAULT_TF = "1d";
    const AUTO_REFRESH_MS = 3 * 60 * 1000;

    const urlTf = new URL(location.href).searchParams.get("tf");
    let currentTf = (urlTf && ["1d","7d","1m","1y"].includes(urlTf)) ? urlTf : DEFAULT_TF;

    const cacheBust = () => new Date().toISOString().replace(/\D/g,"").slice(0,14);
    const buildSrc = (prefix, tf) => `${ASSET_BASE}/${prefix}_${tf}.png?v=${cacheBust()}`;

    function updateAll(tf){
      currentTf = tf;
      document.querySelectorAll(".card").forEach(card=>{
        const prefix = card.dataset.prefix;
        const img = card.querySelector("img.chart");
        const wrap = card.querySelector(".imgWrap");
        const ts = card.querySelector(".timestamp");
        wrap.classList.remove("is-error");
        img.onerror = () => { wrap.classList.add("is-error"); ts.textContent = "æœ€çµ‚æ›´æ–°ï¼šãƒ‡ãƒ¼ã‚¿ãªã—"; };
        img.onload  = () => {
          const now = new Date();
          const jst = new Date(now.getTime() + 9*60*60*1000);
          ts.textContent = `æœ€çµ‚æ›´æ–°ï¼š${jst.toISOString().slice(0,16).replace('T',' ')}`;
        };
        img.src = buildSrc(prefix, tf);
      });
      document.querySelectorAll("#tfToolbar .chip").forEach(b=>{
        const active = b.dataset.tf === tf;
        b.classList.toggle("is-active", active);
        b.setAttribute("aria-selected", active ? "true" : "false");
      });
      const u = new URL(location.href);
      u.searchParams.set("tf", tf);
      history.replaceState(null, "", u.toString());
    }
    document.getElementById("tfToolbar").addEventListener("click", (e)=>{
      const btn = e.target.closest("button[data-tf]"); if(!btn) return; updateAll(btn.dataset.tf);
    });
    updateAll(currentTf);
    if (AUTO_REFRESH_MS){ setInterval(()=>updateAll(currentTf), AUTO_REFRESH_MS); }

    // === ä¸Šæ˜‡ç‡/ä¸‹è½ç‡ è¡¨ç¤ºï¼ˆæ”¹è‰¯ç‰ˆï¼‰ =========================================
    ;(function(){
      const SERIES = [
        { key:'astra4',     intraday:'astra4_intraday.csv',     history:'astra4_history.csv',     anchor:'delta-astra4' },
        { key:'scoin_plus', intraday:'scoin_plus_intraday.csv', history:'scoin_plus_history.csv', anchor:'delta-scoin'  },
        { key:'rbank9',     intraday:'rbank9_intraday.csv',     history:'rbank9_history.csv',     anchor:'delta-rbank9' },
        { key:'ain10',      intraday:'ain10_intraday.csv',      history:'ain10_history.csv',      anchor:'delta-ain10'  },
      ];
      const DECIMALS = 2;
      const MIN_DENOM = 1e-6;     // ã»ã¼0å‰²ã‚Šå›é¿
      const CAP_ABS   = 300;      // ç•°å¸¸å€¤ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆÂ±300%ï¼‰

      // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
      const toJst = d => new Date(d.getTime() + 9*60*60*1000);
      const todayJstStr = () => toJst(new Date()).toISOString().slice(0,10);

      function parseCsvRows(text){
        return text.split(/\r?\n/).map(s=>s.trim()).filter(Boolean).map(line => {
          // ã–ã£ãã‚ŠCSVåˆ†å‰²ï¼ˆã‚«ãƒ³ãƒå«ã‚€ã‚»ãƒ«ã‚’æƒ³å®šã—ãªã„å‰æã®è»½é‡ãƒ‘ãƒ¼ã‚µï¼‰
          return line.split(',').map(v => v.trim());
        });
      }

      // intradayï¼š1åˆ—ã§ã‚‚å¤šåˆ—ã§ã‚‚OKã€‚1åˆ—ç›®ï¼æ™‚é–“ã€ä»¥é™ã®**æ•°å€¤åˆ—ã®å¹³å‡**ã‚’æ¡ç”¨
      function parseIntraday(text){
        const rows = parseCsvRows(text);
        if(rows.length <= 1) return [];
        const header = rows[0];
        const body = rows.slice(1);
        const out = [];
        for(const cols of body){
          if(cols.length < 2) continue;
          const t = new Date(cols[0]);
          if(isNaN(+t)) continue;
          // 2åˆ—ç›®ä»¥é™ã®æ•°å€¤å¹³å‡
          const nums = cols.slice(1).map(x => Number(x)).filter(v => Number.isFinite(v));
          if(nums.length === 0) continue;
          const v = nums.reduce((a,b)=>a+b,0) / nums.length;
          out.push({time:t, value:v});
        }
        out.sort((a,b)=>a.time - b.time);
        return out;
      }

      // historyï¼šdate,value ã®2åˆ—
      function parseHistory(text){
        const rows = parseCsvRows(text);
        if(rows.length <= 1) return [];
        const out = [];
        for(const cols of rows.slice(1)){
          if(cols.length < 2) continue;
          const d = new Date(cols[0]); const v = Number(cols[1]);
          if(isNaN(+d) || !Number.isFinite(v)) continue;
          out.push({date:d, value:v});
        }
        out.sort((a,b)=>a.date - b.date);
        return out;
      }

      function pct(a,b){
        if(Math.abs(b) < MIN_DENOM) return null;
        const p = ((a - b) / Math.abs(b)) * 100;
        if(!Number.isFinite(p)) return null;
        if(Math.abs(p) > CAP_ABS) return null;
        return p;
      }

      function setDelta(id, value){
        const el = document.getElementById(id);
        if(!el) return;
        el.classList.remove('up','down','flat');
        if(value === null){ el.textContent = 'â€”'; el.classList.add('flat'); return; }
        const s = (value>=0?'+':'') + value.toFixed(DECIMALS) + '%';
        el.textContent = s;
        el.classList.add(value>0 ? 'up' : value<0 ? 'down' : 'flat');
      }

      async function fetchText(url){
        const res = await fetch(url, {cache:'no-store'});
        if(!res.ok) throw new Error(res.status + ' ' + url);
        return await res.text();
      }

      async function loadOne(s){
        try{
          // 1) å½“æ—¥ã® intraday ã§ %ï¼ˆå½“æ—¥å§‹å€¤â†’ç›´è¿‘å€¤ï¼‰
          const intradayUrl = `${ASSET_BASE}/${s.intraday}?v=${cacheBust()}`;
          const itext = await fetchText(intradayUrl);
          const irows = parseIntraday(itext);
          const today = todayJstStr();
          const todayRows = irows.filter(r => toJst(r.time).toISOString().slice(0,10) === today);

          let delta = null;
          if(todayRows.length >= 2){
            const first = todayRows[0].value;
            const last  = todayRows[todayRows.length - 1].value;
            delta = pct(last, first);
          }

          // 2) å½“æ—¥æ¬ ææ™‚ã¯ historyï¼ˆç›´è¿‘2å–¶æ¥­æ—¥ã®çµ‚å€¤ï¼‰
          if(delta === null){
            const histUrl = `${ASSET_BASE}/${s.history}?v=${cacheBust()}`;
            const htext = await fetchText(histUrl);
            const hrows = parseHistory(htext);
            if(hrows.length >= 2){
              const a = hrows[hrows.length - 1].value;
              const b = hrows[hrows.length - 2].value;
              delta = pct(a, b);
            }
          }
          setDelta(s.anchor, delta);
        }catch(e){
          setDelta(s.anchor, null);
        }
      }

      function init(){ SERIES.forEach(loadOne); }
      if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', init);
      else init();
    })();
  </script>
</body>
</html>
