<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸŒ¸æ¡œIndex - å…¬å¼ã‚µã‚¤ãƒˆ</title>
<style>
  :root{
    --bg:#0f1217;--panel:#141924;--panel-2:#101520;--text:#e8eef9;--muted:#8ea0bf;
    --accent:#6ad3ff;--teal:#00d1b2;--red:#ff6a6a;--green:#6fe28b;--chip:#1b2333;
    --ring:#23314b;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:14px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";}
  a{color:inherit;text-decoration:none}
  .wrap{max-width:1200px;margin:auto;padding:28px 20px}
  header{display:flex;flex-wrap:wrap;gap:14px;align-items:center;justify-content:space-between;margin-bottom:18px}
  .title{font-weight:700;font-size:26px;display:flex;gap:10px;align-items:center}
  .meta{color:var(--muted);font-size:12px}
  .btn{background:var(--chip);color:var(--text);border:1px solid var(--ring);padding:8px 12px;border-radius:12px}
  .grid{display:grid;gap:18px}
  @media (min-width:920px){.grid{grid-template-columns:1fr 1fr}}
  .card{background:var(--panel);border:1px solid var(--ring);border-radius:16px;overflow:hidden}
  .card-hd{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:14px 16px;background:linear-gradient(0deg,transparent,rgba(255,255,255,0.02))}
  .id-left{display:flex;gap:10px;align-items:center}
  .flag{width:16px;height:16px;border-radius:3px;overflow:hidden;box-shadow:0 0 0 1px var(--ring) inset}
  .badge{font-size:12px;background:var(--chip);border:1px solid var(--ring);padding:4px 8px;border-radius:999px;color:var(--muted)}
  .desc{color:var(--muted);padding:0 16px 8px}
  .pct{font-weight:700}
  .pct.pos{color:var(--green)}
  .pct.neg{color:var(--red)}
  .pct.na{color:var(--muted)}
  .plot{padding:10px 12px 0 12px}
  .frame{position:relative;background:var(--panel-2);border-radius:12px;border:1px solid var(--ring);overflow:hidden}
  .frame::before{content:"";display:block;padding-top:56.25%} /* 16:9 å›ºå®šã§ â€œã‚µã‚¤ã‚ºãŒåˆã£ã¦ã„ãªã„â€ ã‚’è§£æ¶ˆ */
  .img-hold{position:absolute;inset:0;display:flex;align-items:center;justify-content:center}
  .img-hold img{max-width:100%;max-height:100%;object-fit:contain;display:block}
  .tabs{display:flex;gap:10px;flex-wrap:wrap;padding:10px 12px 14px 12px}
  .tab{background:var(--chip);border:1px solid var(--ring);padding:7px 12px;border-radius:999px;color:var(--muted);cursor:pointer;user-select:none;position:relative;z-index:2}
  .tab.active{color:var(--text);box-shadow:0 0 0 2px var(--accent) inset}
  .sr{position:absolute;clip:rect(0 0 0 0);clip-path:inset(50%);height:1px;width:1px;overflow:hidden;white-space:nowrap;padding:0;border:0}
  .ghost{opacity:.65}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <div class="title">ğŸŒ¸ æ¡œIndex - å…¬å¼ã‚µã‚¤ãƒˆ</div>
      <div id="siteMeta" class="meta">åŒæœŸå®Œäº†: <span id="syncAt">-</span> / ãƒ‡ãƒ¼ã‚¿: docs/charts/*</div>
    </div>
    <div style="display:flex;gap:10px">
      <a class="btn" href="https://x.com" target="_blank" rel="noreferrer">å…¬å¼Xï¼ˆTwitterï¼‰</a>
      <a class="btn" href="https://note.com" target="_blank" rel="noreferrer">å…¬å¼note</a>
    </div>
  </header>

  <div id="cards" class="grid"></div>
</div>

<script>
/* ========== è¨­å®šï¼ˆæ—¢å­˜å‡ºåŠ›ã‚’ãã®ã¾ã¾èª­ã‚€ï¼‰ ========== */
const BASE = "docs/charts";                 // ç”»åƒãƒ»ãƒ¡ã‚¿ã®ãƒ«ãƒ¼ãƒˆ
const META_DIR = `${BASE}/meta`;            // ãƒ¡ã‚¿JSONå‡ºåŠ›å…ˆï¼ˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ç”Ÿæˆï¼‰
/*
  ãƒ¡ã‚¿JSON ä¾‹: docs/charts/meta/ain10.json
  {
    "label": "AIN-10",
    "desc": "ç±³AIé–¢é€£10éŠ˜æŸ„ã®ç­‰ã‚¦ã‚§ã‚¤ãƒˆæŒ‡æ•°ã€‚çŸ­æœŸãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ è¦³æ¸¬ã«ä¾¿åˆ©ã€‚",
    "percent": {          // é¨°è½ç‡(%). å‡ºåŠ›ãŒãªã„æ™‚é–“å¸¯ã¯ null ã‚’å…¥ã‚Œã¦OK
      "intraday": 1.23,   // â€œå‰æ—¥çµ‚å€¤æ¯”ï¼ˆ%ï¼‰â€
      "am": -0.15         // ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰å‰å ´ã‚¹ãƒŠãƒƒãƒ—ãŒã‚ã‚‹å ´åˆã®ã¿
    },
    "level": {            // ãƒ¬ãƒ™ãƒ«ç³»ï¼ˆçµ‚å€¤ãƒ™ãƒ¼ã‚¹)
      "1d": 0.352         // R-BANK9 / S-COIN+ ã¯é€šå¸¸ã“ã¡ã‚‰ã® 1d ã‚’ãƒ˜ãƒƒãƒ€ã«ä½¿ã†
    },
    "snapshots": {        // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆæ‹¡å¼µå­å«ã‚€ï¼‰
      "intraday": "ain10_intraday.png",
      "am": "ain10_intraday_am.png",
      "7d": "ain10_7d.png",
      "1m": "ain10_1m.png",
      "1y": "ain10_1y.png"
    },
    "updated": "2025-10-24T15:56:00+09:00"
  }
*/

const INDEXES = [
  {
    key:"astra4",
    title:"Astra4",
    flag:"ğŸ‡¯ğŸ‡µ",
    tag:"å®‡å®™ãƒ™ãƒ³ãƒãƒ£ãƒ¼",
    defaultVariant:"intraday",
    headline: d => safePct(d?.percent?.intraday) ?? null,  // é¨°è½ç‡(%)
    desc: d => d?.desc ?? "å®‡å®™é–¢é€£éŠ˜æŸ„ã®ç­‰ã‚¦ã‚§ã‚¤ãƒˆæŒ‡æ•°ã€‚å¯è¦–åŒ–ã¯ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£ã«é…æ…®ã€‚"
  },
  {
    key:"rbank9",
    title:"R-BANK9",
    flag:"ğŸ‡¯ğŸ‡µ",
    tag:"åœ°æ–¹éŠ€è¡Œ",
    defaultVariant:"intraday",
    // ãƒãƒ£ãƒ¼ãƒˆã¯%ï¼ˆintradayã®PNGï¼‰ã€ãƒ˜ãƒƒãƒ€ãƒ¼ã¯ãƒ¬ãƒ™ãƒ«1dã®å¤‰åŒ–ç‡ã§ã¯ãªã â€œãã®æ°´æº–â€ ã‚’è¡¨ç¤ºã™ã‚‹ã¨ã‚ºãƒ¬ãªã„
    headline: d => safeLevel(d?.level?.["1d"]),             // ãƒ¬ãƒ™ãƒ«
    desc: d => d?.desc ?? "åœ°æ–¹éŠ€è¡Œ9éŠ˜æŸ„ã®ç­‰ã‚¦ã‚§ã‚¤ãƒˆæŒ‡æ•°ã€‚æ—¥ä¸­ã¯%ã€é•·æœŸã¯ãƒ¬ãƒ™ãƒ«æ¨ç§»ã‚’è¡¨ç¤ºã€‚"
  },
  {
    key:"ain10",
    title:"AIN-10",
    flag:"ğŸ‡ºğŸ‡¸",
    tag:"AIé–¢é€£10",
    defaultVariant:"intraday",
    headline: d => safePct(d?.percent?.intraday),
    desc: d => d?.desc ?? "ç±³AIé–¢é€£10éŠ˜æŸ„ã®ç­‰ã‚¦ã‚§ã‚¤ãƒˆæŒ‡æ•°ã€‚çŸ­æœŸãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ è¦³æ¸¬ã«ä¾¿åˆ©ã€‚"
  },
  {
    key:"scoin_plus",
    title:"S-COIN+",
    flag:"ğŸ‡¯ğŸ‡µ",
    tag:"ä»®æƒ³è³‡ç”£é–¢é€£",
    defaultVariant:"intraday",
    headline: d => safeLevel(d?.level?.["1d"]),             // ãƒ¬ãƒ™ãƒ«
    desc: d => d?.desc ?? "æš—å·è³‡ç”£é–¢é€£ã®ç­‰ã‚¦ã‚§ã‚¤ãƒˆæŒ‡æ•°ã€‚æ—¥ä¸­ã¯é¨°è½ç‡ã€é•·æœŸã¯ãƒ¬ãƒ™ãƒ«æ¨ç§»ã‚’è¡¨ç¤ºã€‚"
  }
];

/* ========== ãƒ„ãƒ¼ãƒ«ç¾¤ ========== */
const fmtPct = x => (x>0?"+":"") + x.toFixed(2) + "%";
const fmtLevel = x => x.toFixed(3); // ãƒ¬ãƒ™ãƒ«ã¯3æ¡å›ºå®šï¼ˆãŠå¥½ã¿ã§èª¿æ•´ï¼‰
function safePct(v){
  if (typeof v === "number" && isFinite(v)) return v;
  return null;
}
function safeLevel(v){
  if (typeof v === "number" && isFinite(v)) return v;
  return null;
}
function byQS(el,sel){return el.querySelector(sel)}
function el(html){const t=document.createElement("template");t.innerHTML=html.trim();return t.content.firstElementChild}
function ts(){return Date.now()} // ç”»åƒã‚­ãƒ£ãƒƒã‚·ãƒ¥ç ´ã‚Š

/* ========== ç”»é¢æ§‹ç¯‰ ========== */
const $grid = document.getElementById("cards");
const $syncAt = document.getElementById("syncAt");
$syncAt.textContent = new Date().toLocaleString("ja-JP",{hour12:false});

/* 1æšã®ã‚«ãƒ¼ãƒ‰DOMã‚’è¿”ã™ */
function cardDOM(item, meta){
  const desc = item.desc(meta);
  const label = headlineText(item, meta);
  const pctClass = headlineClass(item, meta);

  const dom = el(`
    <section class="card" data-key="${item.key}">
      <div class="card-hd">
        <div class="id-left">
          <span class="flag" aria-hidden="true"></span>
          <strong>${item.title}</strong>
          <span class="badge">${item.tag}</span>
        </div>
        <div class="pct ${pctClass}" aria-live="polite">${label}</div>
      </div>
      <p class="desc">${desc}</p>
      <div class="plot">
        <div class="frame">
          <div class="img-hold">
            <img alt="${item.title} chart" />
          </div>
        </div>
      </div>
      <div class="tabs" role="tablist" aria-label="${item.title} è¡¨ç¤ºåˆ‡æ›¿">
        <button class="tab" data-v="intraday">Intraday</button>
        <button class="tab" data-v="am">å‰å ´(AM)</button>
        <button class="tab" data-v="7d">7æ—¥</button>
        <button class="tab" data-v="1m">1ãƒ¶æœˆ</button>
        <button class="tab" data-v="1y">1å¹´</button>
      </div>
    </section>
  `);

  // å›½æ——ï¼ˆçµµæ–‡å­— â†’ èƒŒæ™¯ï¼‰
  byQS(dom,'.flag').textContent = item.flag;

  // ç”»åƒåˆæœŸåŒ–
  const img = byQS(dom, 'img');
  const v0  = pickExistingVariant(meta, item.defaultVariant);
  setActive(dom, v0);
  img.src = snapshotSrc(meta, v0);

  // ã‚¿ãƒ–åˆ‡æ›¿ï¼ˆâ€œã‚¯ãƒªãƒƒã‚¯ã§ããªã„â€ å•é¡Œ: z-index ã¨ pointer-events ã¯CSSå´ã§è§£æ±ºæ¸ˆã¿ï¼‰
  dom.querySelectorAll('.tab').forEach(b=>{
    b.addEventListener('click', ()=>{
      const v = b.getAttribute('data-v');
      setActive(dom, v);
      const next = snapshotSrc(meta, v);
      img.classList.add('ghost');
      img.onload = ()=>img.classList.remove('ghost');
      img.onerror = ()=>{ img.classList.remove('ghost'); /* ç”»åƒãªã—ã§ã‚‚è½ã¡ãªã„ */ };
      img.src = next;
    });
  });

  return dom;
}

/* ãƒ˜ãƒƒãƒ€ãƒ¼å³ã®æ•°å€¤/ãƒ†ã‚­ã‚¹ãƒˆï¼ˆ% or ãƒ¬ãƒ™ãƒ« or N/Aï¼‰ */
function headlineText(item, meta){
  const p = item.headline(meta);
  if (p==null) return '<span class="pct na">N/A</span>';
  // ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆã‹ãƒ¬ãƒ™ãƒ«ã‹ã‚’åˆ¤å®šï¼ˆpercentãªã‚‰Â±ã€levelãªã‚‰æ•°å€¤ã®ã¿ï¼‰
  if (item.headline === INDEXES[0].headline || item.headline === INDEXES[2].headline){
    // Astra4 / AIN-10 ã¯ % è¦‹å‡ºã—
    const sign = p>0? "pos" : (p<0? "neg" : "");
    return `<span class="pct ${sign}">${fmtPct(p)}</span>`;
  }else{
    // R-BANK9 / S-COIN+ ã¯ level è¦‹å‡ºã—
    return `<span class="pct">${fmtLevel(p)}</span>`;
  }
}
function headlineClass(item, meta){
  const p = item.headline(meta);
  if (p==null) return "na";
  if (item.headline === INDEXES[0].headline || item.headline === INDEXES[2].headline){
    return p>0? "pos" : (p<0? "neg" : "");
  }
  return ""; // level ã¯è‰²ä»˜ã‘ãªã—
}

/* ç”»åƒã‚½ãƒ¼ã‚¹ï¼ˆå­˜åœ¨ã—ãªã„å ´åˆã¯è‡ªå‹•ã§ â€œã‚ã‚‹ã‚‚ã®â€ ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰ */
function snapshotSrc(meta, variant){
  const f = meta?.snapshots?.[variant];
  if (f) return `${BASE}/${f}?v=${ts()}`;
  // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯é †
  const order = ["intraday","am","7d","1m","1y"];
  for (const k of order){
    if (meta?.snapshots?.[k]) return `${BASE}/${meta.snapshots[k]}?v=${ts()}`;
  }
  // æœ€å¾Œã®ç ¦ï¼šå­˜åœ¨ã—ãªã„æ™‚ã§ã‚‚ alt ãŒæ®‹ã‚‹ã‚ˆã† 1px gif
  return "data:image/gif;base64,R0lGODlhAQABAAAAACw=";
}

/* â€œã‚¯ãƒªãƒƒã‚¯æ™‚ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–è¦‹ãŸç›®â€ ã‚’åˆ¶å¾¡ */
function setActive(card, v){
  card.querySelectorAll('.tab').forEach(t=>{
    t.classList.toggle('active', t.getAttribute('data-v')===v);
  });
}

/* åˆ©ç”¨å¯èƒ½ãªåˆæœŸvariantã‚’é¸ã¶ */
function pickExistingVariant(meta, pref){
  const order = [pref,"intraday","am","7d","1m","1y"];
  for (const k of order){ if (meta?.snapshots?.[k]) return k; }
  return "intraday";
}

/* ========== ãƒ¡ã‚¿ã®èª­ã¿è¾¼ã¿ï¼†æç”» ========== */
async function fetchJSON(url){
  try{
    const r = await fetch(url, {cache:"no-store"});
    if(!r.ok) throw new Error(r.status);
    return await r.json();
  }catch(e){ return null; }
}

(async ()=>{
  for (const it of INDEXES){
    const meta = await fetchJSON(`${META_DIR}/${it.key}.json`) || {};
    // ã‚«ãƒ¼ãƒ‰è¿½åŠ 
    $grid.appendChild(cardDOM(it, meta));
  }
})();
</script>
</body>
</html>
