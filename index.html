<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>🌸 桜Index - 公式サイト</title>
  <meta name="description" content="Astra4・S-COIN+・R-BANK9・AIN-10 の4指数を1画面で同時表示。時間軸を一括切替。">
  <style>
    :root{
      --bg:#0e1014; --panel:#171a22; --text:#e9ecf1; --muted:#a7afc0;
      --chip:#232838; --chip-active:#33405c; --ring:#384055; --accent:#79e3d6;
      --pink:#ff86b5;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font:16px/1.6 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue","Noto Sans JP","Yu Gothic","Meiryo",sans-serif;
    }

    /* Header */
    header{padding:28px 20px 12px;text-align:center}
    h1{
      margin:0 0 8px;
      font-size:28px;
      font-weight:800;
      color:var(--pink);
    }
    .sub{color:var(--muted);font-size:14px}

    /* Buttons */
    .headLinks{display:flex;gap:8px;justify-content:center;margin-top:10px}
    .headLinks a{
      display:inline-flex;gap:8px;align-items:center;
      padding:8px 12px;border-radius:10px;
      background:var(--chip);color:#fff;text-decoration:none;
      box-shadow:inset 0 0 0 1px var(--ring);
    }

    .toolbar{
      margin:18px auto 10px;
      display:flex;gap:10px;justify-content:center;flex-wrap:wrap;
    }
    .chip{
      appearance:none;border:none;cursor:pointer;
      padding:8px 14px;border-radius:999px;
      background:var(--chip);color:var(--text);
      font-weight:600;box-shadow:inset 0 0 0 1px var(--ring);
      transition:.15s;
    }
    .chip:hover{transform:translateY(-1px)}
    .chip.is-active{
      background:var(--chip-active);
      box-shadow:0 0 0 2px var(--accent) inset;
      color:#fff;
    }

    /* Grid layout */
    .grid{
      width:min(1280px,92vw);
      margin:0 auto 28px;
      display:grid;gap:16px;
      grid-template-columns:1fr;
    }
    @media (min-width:900px){.grid{grid-template-columns:1fr 1fr}}

    /* Card */
    .card{
      background:var(--panel);
      border-radius:16px;
      box-shadow:0 0 0 1px var(--ring);
      overflow:hidden;
    }
    .card__head{
      display:flex;align-items:center;justify-content:space-between;
      padding:12px 14px;
      border-bottom:1px solid var(--ring);
      background:linear-gradient(180deg,rgba(121,227,214,.07),transparent);
    }
    .title{display:flex;align-items:center;gap:10px;font-weight:800}
    .flag{font-size:18px;line-height:1}
    .badge{
      font-size:12px;padding:2px 8px;border-radius:999px;
      background:#2a3044;color:#cdd7ff;box-shadow:inset 0 0 0 1px var(--ring);
    }
    .pngnote{color:var(--muted);font-size:12px}

    /* 上昇率/下落率 表示 */
    .delta {
      font-weight:700;
      margin-left:6px;
      font-variant-numeric: tabular-nums;
    }
    .delta.up { color:#32e0cf; }   /* 青緑 */
    .delta.down { color:#ff6b6b; } /* 赤 */
    .delta.flat { color:#9aa0a6; } /* グレー */

    /* Chart area */
    .imgWrap{position:relative;background:#0b0d12}
    .chart{display:block;width:100%;aspect-ratio:16/9;object-fit:contain;background:#0b0d12}
    .nodata{
      position:absolute;inset:0;
      display:flex;align-items:center;justify-content:center;
      color:#91a0c4;font-weight:700;letter-spacing:.02em;
      opacity:0;transition:.15s;
    }
    .imgWrap.is-error .nodata{opacity:1}
    .timestamp{
      text-align:right;
      font-size:12px;
      color:var(--muted);
      padding:6px 10px 10px;
      border-top:1px solid var(--ring);
    }

    /* Footer */
    footer{
      padding:20px 12px 28px;
      text-align:center;
      color:var(--muted);
      font-size:13px;
      line-height:1.8;
    }
    .disclaimer{
      margin-top:10px;
      font-size:13px;
      color:#ffb2b2;
    }
    a{color:#a7dfff}
  </style>
</head>
<body>
  <header>
    <h1>🌸 桜Index - 公式サイト</h1>
    <div class="sub">Astra4・S-COIN+・R-BANK9・AIN-10 を同時表示。時間軸を一括で切替できます。</div>
    <div class="headLinks">
      <a href="https://twitter.com/SakuraIndex" target="_blank" rel="noreferrer noopener">公式X（Twitter）</a>
      <a href="https://note.com/sakuraindex" target="_blank" rel="noreferrer noopener">公式note</a>
    </div>

    <div class="toolbar" id="tfToolbar" role="tablist" aria-label="時間軸">
      <button class="chip is-active" data-tf="1d"  aria-selected="true">1日</button>
      <button class="chip"          data-tf="7d"  aria-selected="false">1週間</button>
      <button class="chip"          data-tf="1m"  aria-selected="false">1ヶ月</button>
      <button class="chip"          data-tf="1y"  aria-selected="false">1年</button>
    </div>
  </header>

  <main class="grid" id="grid">
    <!-- Astra4 🇯🇵 宇宙ベンチャー -->
    <section class="card" data-prefix="astra4">
      <div class="card__head">
        <div class="title">
          <span class="flag">🇯🇵</span><span>Astra4</span><span class="badge">宇宙ベンチャー</span>
          <span id="delta-astra4" class="delta flat">—</span>
        </div>
        <div class="pngnote">PNGを静的表示（自動更新）</div>
      </div>
      <div class="imgWrap">
        <img class="chart" alt="Astra4 chart" />
        <div class="nodata">No data</div>
      </div>
      <div class="timestamp">最終更新：読込中...</div>
    </section>

    <!-- S-COIN+ 🇯🇵 -->
    <section class="card" data-prefix="scoin_plus">
      <div class="card__head">
        <div class="title">
          <span class="flag">🇯🇵</span><span>S-COIN+</span><span class="badge">仮想通貨</span>
          <span id="delta-scoin" class="delta flat">—</span>
        </div>
        <div class="pngnote">PNGを静的表示（自動更新）</div>
      </div>
      <div class="imgWrap">
        <img class="chart" alt="S-COIN+ chart" />
        <div class="nodata">No data</div>
      </div>
      <div class="timestamp">最終更新：読込中...</div>
    </section>

    <!-- R-BANK9 🇯🇵 -->
    <section class="card" data-prefix="rbank9">
      <div class="card__head">
        <div class="title">
          <span class="flag">🇯🇵</span><span>R-BANK9</span><span class="badge">地方銀行</span>
          <span id="delta-rbank9" class="delta flat">—</span>
        </div>
        <div class="pngnote">PNGを静的表示（自動更新）</div>
      </div>
      <div class="imgWrap">
        <img class="chart" alt="R-BANK9 chart" />
        <div class="nodata">No data</div>
      </div>
      <div class="timestamp">最終更新：読込中...</div>
    </section>

    <!-- AIN-10 🇺🇸 -->
    <section class="card" data-prefix="ain10">
      <div class="card__head">
        <div class="title">
          <span class="flag">🇺🇸</span><span>AIN-10</span><span class="badge">AI関連10</span>
          <span id="delta-ain10" class="delta flat">—</span>
        </div>
        <div class="pngnote">PNGを静的表示（自動更新）</div>
      </div>
      <div class="imgWrap">
        <img class="chart" alt="AIN-10 chart" />
        <div class="nodata">No data</div>
      </div>
      <div class="timestamp">最終更新：読込中...</div>
    </section>
  </main>

  <footer>
    データ：等加重指数（詳細は各リポジトリ参照） ／ 画像は各指数レポの自動生成スナップショットを同期しています。<br>
    © 2025 桜Index<br>
    <div class="disclaimer">※ 本サイトは投資助言ではありません。投資判断はご自身の責任（自己責任）でお願いいたします。</div>
  </footer>

  <script>
    // === 表示設定 ===
    const ASSET_BASE = "docs/charts";
    const INDEX_PREFIXES = ["astra4","scoin_plus","rbank9","ain10"];
    const DEFAULT_TF = "1d";
    const AUTO_REFRESH_MS = 3 * 60 * 1000;

    const urlTf = new URL(location.href).searchParams.get("tf");
    let currentTf = (urlTf && ["1d","7d","1m","1y"].includes(urlTf)) ? urlTf : DEFAULT_TF;

    const cacheBust = () => new Date().toISOString().replace(/\D/g,"").slice(0,14);
    const buildSrc = (prefix, tf) => `${ASSET_BASE}/${prefix}_${tf}.png?v=${cacheBust()}`;

    function updateAll(tf){
      currentTf = tf;
      document.querySelectorAll(".card").forEach(card=>{
        const prefix = card.dataset.prefix;
        const img = card.querySelector("img.chart");
        const wrap = card.querySelector(".imgWrap");
        const ts = card.querySelector(".timestamp");
        wrap.classList.remove("is-error");
        img.onerror = () => {
          wrap.classList.add("is-error");
          ts.textContent = "最終更新：データなし";
        };
        img.onload = () => {
          const now = new Date();
          const jst = new Date(now.getTime() + 9*60*60*1000);
          ts.textContent = `最終更新：${jst.toISOString().slice(0,16).replace('T',' ')}`;
        };
        img.src = buildSrc(prefix, tf);
      });
      document.querySelectorAll("#tfToolbar .chip").forEach(b=>{
        const active = b.dataset.tf === tf;
        b.classList.toggle("is-active", active);
        b.setAttribute("aria-selected", active ? "true" : "false");
      });
      const u = new URL(location.href);
      u.searchParams.set("tf", tf);
      history.replaceState(null, "", u.toString());
    }

    document.getElementById("tfToolbar").addEventListener("click", (e)=>{
      const btn = e.target.closest("button[data-tf]");
      if(!btn) return;
      updateAll(btn.dataset.tf);
    });

    updateAll(currentTf);
    if (AUTO_REFRESH_MS){
      setInterval(()=>updateAll(currentTf), AUTO_REFRESH_MS);
    }

    // === 追加: 上昇率/下落率 表示 ===
    (function () {
      const SERIES = [
        { key:'astra4',    file:'astra4_history.csv',     anchor:'delta-astra4' },
        { key:'scoin_plus',file:'scoin_plus_history.csv', anchor:'delta-scoin'  },
        { key:'rbank9',    file:'rbank9_history.csv',     anchor:'delta-rbank9' },
        { key:'ain10',     file:'ain10_history.csv',      anchor:'delta-ain10'  },
      ];
      const DECIMALS = 2;

      function parseCsv(text){
        const rows = text.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
        if (rows.length<=1) return [];
        const out=[];
        for(let i=1;i<rows.length;i++){
          const cols = rows[i].split(',');
          if(cols.length<2) continue;
          const d = new Date(cols[0]);
          const v = Number(cols[1]);
          if(!isFinite(d)||!isFinite(v)) continue;
          out.push({date:d,value:v});
        }
        out.sort((a,b)=>a.date-b.date);
        return out;
      }
      function calcPct(points){
        if(!points||points.length<2) return null;
        const valid = points.slice(-10).map(p=>p.value).filter(v=>isFinite(v));
        if(valid.length<2) return null;
        const vNow = valid[valid.length-1], vPrev = valid[valid.length-2];
        if(Math.abs(vPrev)<1e-12) return null;
        return ((vNow - vPrev)/Math.abs(vPrev))*100;
      }
      function setDelta(id,pct){
        const el=document.getElementById(id);
        if(!el) return;
        el.classList.remove('up','down','flat');
        if(pct===null){ el.textContent='—'; el.classList.add('flat'); return; }
        const s=(pct>=0?'+':'')+pct.toFixed(DECIMALS)+'%';
        el.textContent=s;
        el.classList.add(pct>0?'up':pct<0?'down':'flat');
      }
      async function loadOne(s){
        try{
          const url=`${ASSET_BASE}/${s.file}?v=${cacheBust()}`;
          const res=await fetch(url,{cache:'no-store'});
          if(!res.ok) throw new Error(res.status);
          const text=await res.text();
          const data=parseCsv(text);
          const pct=calcPct(data);
          setDelta(s.anchor,pct);
        }catch(e){setDelta(s.anchor,null);}
      }
      function init(){SERIES.forEach(loadOne);}
      if(document.readyState==='loading')document.addEventListener('DOMContentLoaded',init);else init();
    })();
  </script>
</body>
</html>
