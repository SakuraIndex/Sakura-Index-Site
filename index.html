<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ğŸŒ¸ æ¡œIndex - å…¬å¼ã‚µã‚¤ãƒˆ</title>
  <meta name="description" content="docs/charts/* ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ç”¨ã„ãŸç°¡æ˜“ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <style>
    :root {
      --bg:#0b1220; --panel:#111a2b; --ink:#e6eefc; --sub:#9fb2d3;
      --accent:#66d9ef; --pos:#5ce0a4; --neg:#ff7b7b; --muted:#496185;
      --chip:#1b2640;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",system-ui,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
      color:var(--ink); background:linear-gradient(180deg,#071022 0%,#0b1220 100%);
    }
    .wrap{max-width:1280px;margin:0 auto;padding:24px 16px 64px}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    header h1{margin:0;font-size:22px;letter-spacing:.5px}
    .small{color:var(--sub);font-size:12px}
    .links a{display:inline-block;font-size:12px;padding:8px 12px;color:var(--ink);text-decoration:none;border:1px solid #223152;border-radius:10px;background:#101a2d;margin-left:8px}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .col-6{grid-column:span 6}
    @media (max-width: 980px){.col-6{grid-column:span 12}}
    .card{
      background:linear-gradient(180deg,#0f1a30 0%,#0b1426 100%);
      border:1px solid #1b2743;border-radius:14px;box-shadow:0 10px 28px rgba(0,0,0,.35);
      overflow:hidden; display:flex; flex-direction:column; min-height:380px;
    }
    .card .head{padding:14px 14px 8px;display:flex;align-items:center;gap:10px}
    .card .title{font-weight:700}
    .badge{font-size:11px;color:var(--sub);background:var(--chip);border:1px solid #243557;border-radius:999px;padding:4px 8px}
    .delta{margin-left:auto;font-weight:700}
    .delta.pos{color:var(--pos)} .delta.neg{color:var(--neg)} .delta.na{color:var(--muted)}
    .desc{color:var(--sub);font-size:12px;padding:0 14px 6px}
    .media{flex:1; display:flex;align-items:center;justify-content:center;padding:6px 8px 14px}
    .media img{display:block;width:100%;height:auto;border:1px solid #203356;border-radius:10px;background:#0a1326}
    .tabs{display:flex;gap:8px;padding:10px 12px;border-top:1px solid #1b2743;background:#0c1529}
    .tabs .chip{font-size:12px;color:var(--ink);border:1px solid #223152;background:#111a2c;border-radius:999px;padding:8px 10px}
    footer{margin-top:26px;color:var(--sub);font-size:12px;text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ğŸŒ¸ æ¡œIndex - å…¬å¼ã‚µã‚¤ãƒˆ</h1>
      <div class="links">
        <a href="https://x.com/" target="_blank" rel="noopener">å…¬å¼Xï¼ˆTwitterï¼‰</a>
        <a href="https://note.com/" target="_blank" rel="noopener">å…¬å¼note</a>
      </div>
    </header>
    <div class="small" id="synced-at">åŒæœŸå®Œäº†ï¼šâ€” / ãƒ‡ãƒ¼ã‚¿: docs/charts/*</div>

    <section class="grid" id="cards">
      <!-- ã“ã“ã«JSã§ã‚«ãƒ¼ãƒ‰ã‚’æç”» -->
    </section>

    <footer>
      ãƒ‡ãƒ¼ã‚¿ï¼šå„æŒ‡æ•°ã¯ç­‰åŠ é‡æŒ‡æ•°ï¼ˆä»•æ§˜ã¯å„ãƒªãƒã‚¸ãƒˆãƒªå‚ç…§ï¼‰ï¼ ç”»åƒã¯å„æŒ‡æ•°ãƒªãƒã®è‡ªå‹•ç”Ÿæˆã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¨åŒæœŸã—ã¦ã„ã¾ã™ã€‚<br>
      â€»æœ¬ã‚µã‚¤ãƒˆã¯æŠ•è³‡åŠ©è¨€ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æŠ•è³‡åˆ¤æ–­ã¯ã”è‡ªèº«ã®è²¬ä»»ï¼ˆè‡ªå·±è²¬ä»»ï¼‰ã§ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚<br>
      Â© <span id="y"></span> æ¡œIndex
    </footer>
  </div>

  <script>
  // ====== ã“ã“ã‹ã‚‰JS ======

  // 1) è¡¨ç¤ºå¯¾è±¡ï¼ˆå¿…è¦ãªã‚‰ä¸¦ã³é †ãƒ»æ–‡è¨€ã‚’ç·¨é›†ï¼‰
  const INDEXES = [
    {
      id: 'ASTRA4',
      title: 'Astra4',
      badge: 'å®‡å®™ãƒ™ãƒ³ãƒãƒ£ãƒ¼',
      desc: 'å®‡å®™é–¢é€£éŠ˜æŸ„ã®ç­‰ã‚¦ã‚§ã‚¤ãƒˆæŒ‡æ•°ã€‚æ—¥ä¸­ã¯ï¼…ã€é•·æœŸã¯ãƒ¬ãƒ™ãƒ«æ¨ç§»ã‚’è¡¨ç¤ºã€‚',
    },
    {
      id: 'R-BANK9',
      title: 'R-BANK9',
      badge: 'åœ°æ–¹éŠ€è¡Œ',
      desc: 'åœ°æ–¹éŠ€è¡Œ9éŠ˜æŸ„ã®ç­‰ã‚¦ã‚§ã‚¤ãƒˆæŒ‡æ•°ã€‚æ—¥ä¸­ã¯ï¼…ã€é•·æœŸã¯ãƒ¬ãƒ™ãƒ«æ¨ç§»ã‚’è¡¨ç¤ºã€‚',
    },
    {
      id: 'AIN-10',
      title: 'AIN-10',
      badge: 'AIé–¢é€£10',
      desc: 'ç±³AIé–¢é€£10éŠ˜æŸ„ã®ç­‰ã‚¦ã‚§ã‚¤ãƒˆæŒ‡æ•°ã€‚çŸ­æœŸãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ è¦³æ¸¬ã«ä¾¿åˆ©ã€‚',
    },
    {
      id: 'S-COIN+',
      title: 'S-COIN+',
      badge: 'ä»®æƒ³è³‡ç”£é–¢é€£',
      desc: 'æš—å·è³‡ç”£é–¢é€£ã®ç­‰ã‚¦ã‚§ã‚¤ãƒˆæŒ‡æ•°ã€‚æ—¥ä¸­ã¯é¨°è½ç‡ã€é•·æœŸã¯ãƒ¬ãƒ™ãƒ«æ¨ç§»ã‚’è¡¨ç¤ºã€‚',
    },
  ];

  // 2) ãƒ‘ã‚¹ä½œæˆï¼ˆãƒ•ã‚©ãƒ«ãƒ€åã« + ã‚„ ç©ºç™½ãŒã‚ã‚‹ã®ã§ encodeï¼‰
  const baseCharts = (id) => `/charts/${encodeURIComponent(id)}`;
  const pathJson  = (id) => `${baseCharts(id)}/stats.json`;
  const pathIntraday = (id) => `${baseCharts(id)}/intraday.png`;
  const pathAm       = (id) => `${baseCharts(id)}/intraday_am.png`; // ã‚ã‚Œã°ä½¿ã†

  // 3) é¨°è½ç‡ã®è¨ˆç®—ï¼ˆstats.json ã®ä¸æƒã„ã«å®Œå…¨å¯¾å¿œï¼‰
  function pickDeltaPct(stats) {
    // å„ªå…ˆé †ä½:
    //  (A) delta_level + scale=percent -> delta_level * 100
    //  (B) pct_intraday -> *100
    //  (C) pct_id       -> *100 ã ãŒå¤–ã‚Œå€¤ï¼ˆÂ±30%è¶…ï¼‰ã¯ç ´æ£„
    if (stats && typeof stats.delta_level === 'number' && (stats.scale === 'percent' || stats.value_type === 'percent')) {
      return stats.delta_level * 100;
    }
    if (stats && typeof stats.pct_intraday === 'number') {
      return stats.pct_intraday * 100;
    }
    if (stats && typeof stats.pct_id === 'number') {
      const v = stats.pct_id * 100;
      // å–ã‚Šæ‰±ã„æ³¨æ„: æ˜ã‚‰ã‹ãªå¤–ã‚Œå€¤ã¯æ¡ç”¨ã—ãªã„ï¼ˆéå»ã® AIN-10 å¯¾ç­–ï¼‰
      if (Math.abs(v) <= 30) return v;
    }
    return null; // ä¸æ˜
  }
  const fmt = (v) => `${v >= 0 ? '+' : ''}${v.toFixed(2)}%`;

  // 4) ç”»åƒã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆintraday.png â†’ intraday_am.pngï¼‰
  async function resolveImage(id) {
    async function exists(url) {
      try {
        const r = await fetch(url, { method: 'HEAD', cache: 'no-store' });
        return r.ok;
      } catch { return false; }
    }
    const a = pathIntraday(id);
    if (await exists(a)) return a;
    const b = pathAm(id);
    if (await exists(b)) return b;
    return null;
  }

  // 5) 1æšã®ã‚«ãƒ¼ãƒ‰ã‚’æç”»
  function renderCardSkeleton({ id, title, badge, desc }) {
    const col = document.createElement('article');
    col.className = 'col-6';
    col.innerHTML = `
      <div class="card" id="card-${id}">
        <div class="head">
          <div class="title">${title}</div>
          <span class="badge">${badge}</span>
          <div class="delta na" id="delta-${id}">N/A</div>
        </div>
        <div class="desc">${desc}</div>
        <div class="media">
          <img id="img-${id}" alt="${title} chart" src="" loading="lazy" />
        </div>
        <div class="tabs">
          <span class="chip">Intraday</span>
          <span class="chip">å‰å ´(AM)</span>
          <span class="chip">7æ—¥</span>
          <span class="chip">1ãƒ¶æœˆ</span>
          <span class="chip">1å¹´</span>
        </div>
      </div>
    `;
    return col;
  }

  // 6) å…¨ä½“æç”»
  async function boot() {
    // å¹´
    document.getElementById('y').textContent = new Date().getFullYear();
    // åŒæœŸæ™‚åˆ»ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«è¡¨ç¤ºã§OKï¼‰
    const dt = new Date();
    const pad = (n) => String(n).padStart(2, '0');
    const label = `${dt.getFullYear()}/${pad(dt.getMonth()+1)}/${pad(dt.getDate())} ${pad(dt.getHours())}:${pad(dt.getMinutes())}:${pad(dt.getSeconds())}`;
    document.getElementById('synced-at').textContent = `åŒæœŸå®Œäº†ï¼š${label} / ãƒ‡ãƒ¼ã‚¿: docs/charts/*`;

    const host = document.getElementById('cards');

    // ã‚¹ã‚±ãƒ«ãƒˆãƒ³é…ç½®
    INDEXES.forEach(cfg => host.appendChild(renderCardSkeleton(cfg)));

    // ãƒ‡ãƒ¼ã‚¿æŠ•å…¥
    for (const idx of INDEXES) {
      const $delta = document.getElementById(`delta-${idx.id}`);
      const $img   = document.getElementById(`img-${idx.id}`);

      // ç”»åƒ
      resolveImage(idx.id).then(src => {
        if (src) $img.src = src; else $img.style.display = 'none';
      });

      // stats.json
      try {
        const r = await fetch(pathJson(idx.id), { cache: 'no-store' });
        if (!r.ok) throw new Error(`${idx.id} stats.json not found`);
        const stats = await r.json();

        const v = pickDeltaPct(stats);
        if (v === null || Number.isNaN(v)) {
          $delta.textContent = 'N/A';
          $delta.className = 'delta na';
        } else {
          $delta.textContent = fmt(v);
          $delta.className = 'delta ' + (v>0?'pos':(v<0?'neg':'na'));
        }
      } catch (e) {
        $delta.textContent = 'N/A';
        $delta.className = 'delta na';
        // console.debug(e);
      }
    }
  }

  boot();
  // ====== ã“ã“ã¾ã§JS ======
  </script>
</body>
</html>
