<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ğŸŒ¸ æ¡œIndex - å…¬å¼ã‚µã‚¤ãƒˆ</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    :root{
      --bg:#0e0f13; --panel:#161821; --text:#e7ecf1; --muted:#9aa4ad;
      --accent:#ff70a6; --line:#2a2e3a; --up:#ff6b6b; --down:#4ecdc4;
      --chip:#202431; --chip-active:#2a3142;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font:14px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans JP", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif}
    a{color:inherit}
    .wrap{max-width:1240px;margin:24px auto;padding:0 16px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:18px}
    .title{display:flex;gap:10px;align-items:center}
    .title h1{font-size:22px;margin:0}
    .links{display:flex;gap:8px}
    .btn{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:10px;background:var(--chip);color:var(--text);text-decoration:none;border:1px solid var(--line)}
    .btn:hover{background:var(--chip-active)}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:18px}
    @media (max-width:880px){.grid{grid-template-columns:1fr}}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:14px;display:flex;flex-direction:column;gap:10px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .name{display:flex;align-items:center;gap:8px}
    .badge{font-size:12px;color:var(--muted);padding:2px 8px;border:1px solid var(--line);border-radius:999px;background:var(--chip)}
    .pct{font-weight:600;font-size:18px;min-width:92px;text-align:right}
    .tabs{display:flex;gap:6px}
    .tab{padding:4px 8px;border-radius:8px;background:var(--chip);border:1px solid var(--line);cursor:pointer;color:var(--text);font-size:12px}
    .tab.active{background:var(--chip-active);border-color:var(--accent)}
    .chart{width:100%;aspect-ratio:16/9;background:#0b0c10;border:1px solid var(--line);border-radius:10px;display:block;object-fit:cover}
    footer{margin:22px 0 8px;color:var(--muted);font-size:12px;text-align:center}
    .tiny{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <span style="font-size:20px">ğŸŒ¸</span>
        <h1>æ¡œIndex - å…¬å¼ã‚µã‚¤ãƒˆ</h1>
      </div>
      <div class="links">
        <a class="btn" href="https://x.com" rel="noopener" target="_blank">å…¬å¼Xï¼ˆTwitterï¼‰</a>
        <a class="btn" href="https://note.com" rel="noopener" target="_blank">å…¬å¼note</a>
      </div>
    </header>

    <div class="tiny" id="syncInfo">charts loadingâ€¦</div>

    <!-- 4æŒ‡æ•°ãƒ‘ãƒãƒ« -->
    <section class="grid" id="panels">
      <!-- ãƒ†ãƒ³ãƒ—ãƒ¬ã¯JSã§å¢—æ®– -->
    </section>

    <footer>
      <div>ãƒ‡ãƒ¼ã‚¿ï¼šç­‰åŠ é‡æŒ‡æ•°ï¼ˆä»•æ§˜ã¯å„ãƒªãƒã‚¸ãƒˆãƒªå‚ç…§ï¼‰ï¼ ç”»åƒã¯å„æŒ‡æ•°ãƒªãƒã®è‡ªå‹•ç”Ÿæˆã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’åŒæœŸã—ã¦ã„ã¾ã™ã€‚</div>
      <div>â€» æœ¬ã‚µã‚¤ãƒˆã¯æŠ•è³‡åŠ©è¨€ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æŠ•è³‡åˆ¤æ–­ã¯ã”è‡ªèº«ã®è²¬ä»»ï¼ˆè‡ªå·±è²¬ä»»ï¼‰ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚</div>
      <div class="tiny">Â© 2025 æ¡œIndex</div>
    </footer>
  </div>

  <script>
    // ===== è¨­å®š =====
    const INDEXES = [
      { key: "astra4",     label: "Astra4",     tag: "å®‡å®™ãƒ™ãƒ³ãƒãƒ£ãƒ¼", flag: "ğŸ‡¯ğŸ‡µ" },
      { key: "scoin_plus", label: "S-COIN+",    tag: "ä»®æƒ³é€šè²¨é–¢é€£",   flag: "ğŸ’±" },
      { key: "rbank9",     label: "R-BANK9",    tag: "åœ°æ–¹éŠ€è¡Œ",       flag: "ğŸ‡¯ğŸ‡µ" },
      { key: "ain10",      label: "AIN-10",     tag: "AIé–¢é€£10",       flag: "ğŸ‡ºğŸ‡¸" },
    ];
    const HORIZONS = [
      { id: "1d", label: "1æ—¥" },
      { id: "7d", label: "1é€±é–“" },
      { id: "1m", label: "1ãƒ¶æœˆ" },
      { id: "1y", label: "1å¹´" },
    ];

    const qs = sel => document.querySelector(sel);
    const elPanels = qs("#panels");
    const cacheBust = () => `?v=${Date.now()}`;

    function fmtPct(v) {
      if (typeof v !== "number" || !isFinite(v)) return "â€“";
      const sign = v >= 0 ? "+" : "";
      return `${sign}${v.toFixed(2)}%`;
    }
    function colorPct(v) {
      if (typeof v !== "number" || !isFinite(v)) return "var(--text)";
      return v >= 0 ? "var(--up)" : "var(--down)";
    }

    function panelHTML(idx) {
      const tabs = HORIZONS.map((h,i)=>
        `<button class="tab${i===0?" active":""}" data-h="${h.id}">${h.label}</button>`
      ).join("");
      return `
        <article class="card" id="card-${idx.key}">
          <div class="row">
            <div class="name">
              <div class="badge">${idx.flag}</div>
              <strong>${idx.label}</strong>
              <span class="badge">${idx.tag}</span>
            </div>
            <div class="pct" id="${idx.key}-pct">â€“</div>
          </div>
          <div class="row">
            <div class="tabs" id="${idx.key}-tabs">${tabs}</div>
            <div class="tiny" id="${idx.key}-updated"></div>
          </div>
          <img id="${idx.key}-img" class="chart" alt="${idx.label} chart" src="">
        </article>
      `;
    }

    // ãƒ‘ãƒãƒ«ç”Ÿæˆ
    INDEXES.forEach(idx => elPanels.insertAdjacentHTML("beforeend", panelHTML(idx)));

    // ç”»åƒã¨çµ±è¨ˆã‚’ãƒ­ãƒ¼ãƒ‰
    async function loadFor(key){
      // stats.json
      try{
        const res = await fetch(`docs/charts/${key}_stats.json${cacheBust()}`);
        if(res.ok){
          const s = await res.json();
          const pct = Number(s.pct_1d);
          const elPct = qs(`#${key}-pct`);
          const elUpd = qs(`#${key}-updated`);
          elPct.textContent = fmtPct(pct);
          elPct.style.color = colorPct(pct);
          elUpd.textContent = s.updated_at ? new Date(s.updated_at).toLocaleString() : "";
          elPct.title = `scale: ${s.scale || "n/a"} / updated: ${s.updated_at || "n/a"}`;
        }
      }catch(e){ console.warn("stats load failed:", key, e); }

      // åˆæœŸãƒãƒ£ãƒ¼ãƒˆï¼ˆ1dï¼‰
      const img = qs(`#${key}-img`);
      img.src = `docs/charts/${key}_1d.png${cacheBust()}`;
    }

    // ã‚¿ãƒ–åˆ‡æ›¿
    function bindTabs(key){
      const wrap = qs(`#${key}-tabs`);
      wrap.addEventListener("click", ev=>{
        const btn = ev.target.closest(".tab");
        if(!btn) return;
        wrap.querySelectorAll(".tab").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        const h = btn.getAttribute("data-h");
        const img = qs(`#${key}-img`);
        img.src = `docs/charts/${key}_${h}.png${cacheBust()}`;
      });
    }

    (async function init(){
      INDEXES.forEach(i => bindTabs(i.key));
      await Promise.all(INDEXES.map(i=>loadFor(i.key)));

      // åŒæœŸãƒ­ã‚°ï¼ˆã‚µã‚¤ãƒˆå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«æ™‚åˆ»ã‚’ã–ã£ãã‚Šè¡¨ç¤ºï¼‰
      const stamp = new Date().toLocaleString();
      qs("#syncInfo").textContent = `åŒæœŸå®Œäº†: ${stamp} / ãƒ‡ãƒ¼ã‚¿: docs/charts/*`;
    })();
  </script>
</body>
</html>
